<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>odoo-orm</title>
<link href='dark.base.css' rel='stylesheet' type='text/css' />
<link href='dark.night.css' rel='stylesheet' type='text/css' />
<link href='dark.github.css' rel='stylesheet' type='text/css' />
<link href='dark.pixyll.css' rel='stylesheet' type='text/css' />
<link href='dark.whitey.css' rel='stylesheet' type='text/css' />
<link href='dark.newsprint.css' rel='stylesheet' type='text/css' />
</head>
<body class='typora-export os-windows' >
<div  id='write'  class = 'is-node'><p>&nbsp;</p><div class='md-toc' mdtype='toc'><p class="md-toc-content"><span class="md-toc-item md-toc-h1" data-ref="n3"><a class="md-toc-inner" href="#header-n3">ORM</a></span><span class="md-toc-item md-toc-h2" data-ref="n4"><a class="md-toc-inner" href="#header-n4">Recordsets</a></span><span class="md-toc-item md-toc-h2" data-ref="n21"><a class="md-toc-inner" href="#header-n21">集合操作</a></span><span class="md-toc-item md-toc-h3" data-ref="n36"><a class="md-toc-inner" href="#header-n36">其他记录集操作</a></span><span class="md-toc-item md-toc-h2" data-ref="n51"><a class="md-toc-inner" href="#header-n51">环境Environment </a></span><span class="md-toc-item md-toc-h3" data-ref="n58"><a class="md-toc-inner" href="#header-n58">改变环境</a></span><span class="md-toc-item md-toc-h2" data-ref="n73"><a class="md-toc-inner" href="#header-n73">常见的ORM方法</a></span><span class="md-toc-item md-toc-h2" data-ref="n100"><a class="md-toc-inner" href="#header-n100">创建模型</a></span><span class="md-toc-item md-toc-h3" data-ref="n110"><a class="md-toc-inner" href="#header-n110">计算字段</a></span><span class="md-toc-item md-toc-h3" data-ref="n133"><a class="md-toc-inner" href="#header-n133">关联字段</a></span><span class="md-toc-item md-toc-h3" data-ref="n136"><a class="md-toc-inner" href="#header-n136">onchange：动态更新UI</a></span><span class="md-toc-item md-toc-h3" data-ref="n155"><a class="md-toc-inner" href="#header-n155">低级SQL</a></span><span class="md-toc-item md-toc-h3" data-ref="n161"><a class="md-toc-inner" href="#header-n161">CRUD</a></span><span class="md-toc-item md-toc-h6" data-ref="n162"><a class="md-toc-inner" href="#header-n162"><code>create(vals_list) → records</code></a></span><span class="md-toc-item md-toc-h6" data-ref="n187"><a class="md-toc-inner" href="#header-n187"><code>browse([*ids*]) → records</code></a></span><span class="md-toc-item md-toc-h6" data-ref="n190"><a class="md-toc-inner" href="#header-n190"><code>unlink()</code></a></span><span class="md-toc-item md-toc-h6" data-ref="n204"><a class="md-toc-inner" href="#header-n204"><code>write(*vals*)</code></a></span><span class="md-toc-item md-toc-h6" data-ref="n266"><a class="md-toc-inner" href="#header-n266"><code>read([*fields*])</code></a></span><span class="md-toc-item md-toc-h6" data-ref="n274"><a class="md-toc-inner" href="#header-n274"><code>read_group(*domain*, *fields*, *groupby*, *offset=0*, *limit=None*, *orderby=False*, *lazy=True*)</code></a></span><span class="md-toc-item md-toc-h3" data-ref="n311"><a class="md-toc-inner" href="#header-n311">搜索</a></span><span class="md-toc-item md-toc-h6" data-ref="n312"><a class="md-toc-inner" href="#header-n312"><code>search(*args[, offset=0][, limit=None][, order=None][, count=False]*)</code></a></span><span class="md-toc-item md-toc-h6" data-ref="n334"><a class="md-toc-inner" href="#header-n334"><code>search_count(*args*) → int</code></a></span><span class="md-toc-item md-toc-h6" data-ref="n336"><a class="md-toc-inner" href="#header-n336"><code>name_search(*name=''*, *args=None*, *operator='ilike'*, *limit=100*) → records</code></a></span><span class="md-toc-item md-toc-h3" data-ref="n354"><a class="md-toc-inner" href="#header-n354">记录集操作</a></span><span class="md-toc-item md-toc-h6" data-ref="n355"><a class="md-toc-inner" href="#header-n355"><code>ids</code></a></span><span class="md-toc-item md-toc-h6" data-ref="n357"><a class="md-toc-inner" href="#header-n357"><code>ensure_one()</code></a></span><span class="md-toc-item md-toc-h6" data-ref="n359"><a class="md-toc-inner" href="#header-n359"><code>exists() → records</code></a></span><span class="md-toc-item md-toc-h6" data-ref="n363"><a class="md-toc-inner" href="#header-n363"><code>filtered(*func*)</code></a></span><span class="md-toc-item md-toc-h6" data-ref="n367"><a class="md-toc-inner" href="#header-n367"><code>sorted(*key=None*, *reverse=False*)</code></a></span><span class="md-toc-item md-toc-h6" data-ref="n375"><a class="md-toc-inner" href="#header-n375"><code>mapped(*func*)</code></a></span><span class="md-toc-item md-toc-h3" data-ref="n379"><a class="md-toc-inner" href="#header-n379">环境交换</a></span><span class="md-toc-item md-toc-h6" data-ref="n380"><a class="md-toc-inner" href="#header-n380"><code>sudo([*user=SUPERUSER*])</code></a></span><span class="md-toc-item md-toc-h6" data-ref="n386"><a class="md-toc-inner" href="#header-n386"><code>with_context(*[context][, \**overrides]*) → records</code></a></span><span class="md-toc-item md-toc-h6" data-ref="n390"><a class="md-toc-inner" href="#header-n390"><code>with_env(*env*)</code></a></span><span class="md-toc-item md-toc-h3" data-ref="n392"><a class="md-toc-inner" href="#header-n392">警告</a></span><span class="md-toc-item md-toc-h3" data-ref="n394"><a class="md-toc-inner" href="#header-n394">字段和视图查询</a></span><span class="md-toc-item md-toc-h6" data-ref="n395"><a class="md-toc-inner" href="#header-n395"><code>fields_get(*[fields][, attributes]*)</code></a></span><span class="md-toc-item md-toc-h6" data-ref="n404"><a class="md-toc-inner" href="#header-n404"><code>fields_view_get([*view_id | view_type='form'*])</code></a></span><span class="md-toc-item md-toc-h3" data-ref="n430"><a class="md-toc-inner" href="#header-n430">杂项方法</a></span><span class="md-toc-item md-toc-h6" data-ref="n431"><a class="md-toc-inner" href="#header-n431"><code>default_get(*fields*) → default_values</code></a></span><span class="md-toc-item md-toc-h6" data-ref="n437"><a class="md-toc-inner" href="#header-n437"><code>copy(*default=None*)</code></a></span><span class="md-toc-item md-toc-h6" data-ref="n443"><a class="md-toc-inner" href="#header-n443"><code>name_get() → [(id, name), ...]</code></a></span><span class="md-toc-item md-toc-h6" data-ref="n449"><a class="md-toc-inner" href="#header-n449"><code>name_create(*name*) → record</code></a></span><span class="md-toc-item md-toc-h3" data-ref="n459"><a class="md-toc-inner" href="#header-n459">自动字段</a></span><span class="md-toc-item md-toc-h6" data-ref="n460"><a class="md-toc-inner" href="#header-n460"><code>id</code>  <span>	</span></a></span><span class="md-toc-item md-toc-h6" data-ref="n462"><a class="md-toc-inner" href="#header-n462"><code>_log_access</code></a></span><span class="md-toc-item md-toc-h6" data-ref="n464"><a class="md-toc-inner" href="#header-n464"><code>create_date</code></a></span><span class="md-toc-item md-toc-h6" data-ref="n468"><a class="md-toc-inner" href="#header-n468"><code>create_uid</code></a></span><span class="md-toc-item md-toc-h6" data-ref="n472"><a class="md-toc-inner" href="#header-n472"><code>write_date</code></a></span><span class="md-toc-item md-toc-h6" data-ref="n476"><a class="md-toc-inner" href="#header-n476"><code>write_uid</code></a></span><span class="md-toc-item md-toc-h2" data-ref="n481"><a class="md-toc-inner" href="#header-n481">字段</a></span><span class="md-toc-item md-toc-h3" data-ref="n482"><a class="md-toc-inner" href="#header-n482">基本领域</a></span><span class="md-toc-item md-toc-h6" data-ref="n483"><a class="md-toc-inner" href="#header-n483"><code>class odoo.fields.Field(string=&lt;object object&gt;, **kwargs)</code></a></span><span class="md-toc-item md-toc-h4" data-ref="n507"><a class="md-toc-inner" href="#header-n507">计算字段</a></span></p></div><h1><a name='header-n3' class='md-header-anchor '></a>ORM</h1><h2><a name='header-n4' class='md-header-anchor '></a>Recordsets</h2><p><strong>与模型和记录的交互是通过记录集执行的，记录集是同一模型的有序记录集。 </strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">AModel</span>(<span class="cm-variable">models</span>.<span class="cm-property">Model</span>):</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">_name</span> = <span class="cm-string">'a.model'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">def</span> <span class="cm-def">a_method</span>(<span class="cm-variable-2">self</span>):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># self can be anywhere between 0 records and all records in the</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># database</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self</span>.<span class="cm-property">do_operation</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">#模型上定义的方法在记录集上执行，它们self是记录集</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">print</span>(<span class="cm-variable-2">self</span>)<span class="cm-comment"># =&gt; a.model(1, 2, 3, 4, 5)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">#迭代记录集将产生新的单个记录集 （“单例”）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> <span class="cm-variable">record</span> <span class="cm-keyword">in</span> <span class="cm-variable-2">self</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">print</span> <span class="cm-variable">record</span> <span class="cm-comment"># =&gt; a.model(1), then a.model(2), then a.model(3), ...</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><p>&nbsp;</p><p><strong>记录集提供“活动记录”界面：</strong></p><p>模型字段可以作为属性直接从记录中读取和写入，但仅限于单个记录（单记录记录集）。字段值也可以像dict项一样访问，这比<code>getattr()</code>动态字段名称更优雅，更安全。设置字段的值会触发对数据库的更新： </p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&gt;&gt;&gt;</span> <span class="cm-variable">record</span>.<span class="cm-property">name</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Example</span> <span class="cm-variable">Name</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&gt;&gt;&gt;</span> <span class="cm-variable">record</span>.<span class="cm-property">company_id</span>.<span class="cm-property">name</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Company</span> <span class="cm-variable">Name</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&gt;&gt;&gt;</span> <span class="cm-variable">record</span>.<span class="cm-property">name</span> = <span class="cm-string">"Bob"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&gt;&gt;&gt;</span> <span class="cm-variable">field</span> = <span class="cm-string">"name"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&gt;&gt;&gt;</span> <span class="cm-variable">record</span>[<span class="cm-variable">field</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Bob</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#尝试在多个记录上读取或写入字段会引发错误。</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 234px;"></div><div class="CodeMirror-gutters" style="display: none; height: 234px;"></div></div></div></pre><p>&nbsp;</p><p><strong>设置字段</strong></p><p>对字段的每个设置都会触发数据库更新，当同时设置多个字段或在多个记录上设置字段（到相同的值）时，使用<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.models.Model.write'><code>write()</code></a>： </p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 3 * len(records) database updates</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">record</span> <span class="cm-keyword">in</span> <span class="cm-variable">records</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">record</span>.<span class="cm-property">a</span> = <span class="cm-number">1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">record</span>.<span class="cm-property">b</span> = <span class="cm-number">2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">record</span>.<span class="cm-property">c</span> = <span class="cm-number">3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># len(records) database updates</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">record</span> <span class="cm-keyword">in</span> <span class="cm-variable">records</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">record</span>.<span class="cm-property">write</span>({<span class="cm-string">'a'</span>: <span class="cm-number">1</span>, <span class="cm-string">'b'</span>: <span class="cm-number">2</span>, <span class="cm-string">'c'</span>: <span class="cm-number">3</span>})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 1 database update</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">records</span>.<span class="cm-property">write</span>({<span class="cm-string">'a'</span>: <span class="cm-number">1</span>, <span class="cm-string">'b'</span>: <span class="cm-number">2</span>, <span class="cm-string">'c'</span>: <span class="cm-number">3</span>})</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 312px;"></div><div class="CodeMirror-gutters" style="display: none; height: 312px;"></div></div></div></pre><p>&nbsp;</p><p><strong>记录缓存和预取</strong></p><p>Odoo维护记录字段的缓存，因此并非每个字段访问都会发出数据库请求，这对性能来说太糟糕了。以下示例仅针对第一个语句查询数据库</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">record</span>.<span class="cm-property">name</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># first access reads value from database</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">record</span>.<span class="cm-property">name</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># second access gets value from cache</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 52px;"></div><div class="CodeMirror-gutters" style="display: none; height: 52px;"></div></div></div></pre><p>为了避免一次在一条记录上读取一个字段，Odoo会根据一些启发式方法<em>预取</em>记录和字段以获得良好的性能。一旦必须在给定记录上读取字段，ORM实际上会在较大的记录集上读取该字段，并将返回的值存储在缓存中供以后使用。预取记录集通常是记录集，记录来自迭代。此外，所有简单的存储字段（boolean, integer, float, char, text, date, datetime, selection, many2one ）都被完全取出; 它们对应于模型表的列，并在同一查询中有效获取 </p><p>&nbsp;</p><h2><a name='header-n21' class='md-header-anchor '></a>集合操作</h2><p>记录集是不可变的，但可以使用各种set操作组合相同模型的集合，返回新的记录集。设置操作不会保留顺序。</p><ul><li><code>record in set</code>返回是否存在<code>record</code>（必须是1元素记录集）<code>set</code>。<code>record not in set</code>是逆操作</li><li><code>set1 &lt;= set2</code>并<code>set1 &lt; set2</code>返回是否<code>set1</code>是<code>set2</code>（resp. stric 严格模式）的子集</li><li><code>set1 &gt;= set2</code>并<code>set1 &gt; set2</code>返回是否<code>set1</code>是<code>set2</code>（resp. stric）的超集</li><li><code>set1 | set2</code> 返回两个记录集的并集，一个包含任一源中存在的所有记录的新记录集</li><li><code>set1 &amp; set2</code> 返回两个记录集的交集，一个新记录集仅包含两个源中存在的记录</li><li>set1  -  set2返回一个新记录集，其中只包含set1中不在set2中的记录</li></ul><h3><a name='header-n36' class='md-header-anchor '></a>其他记录集操作</h3><p>记录集是可迭代的，因此普通的Python工具可用于转化他们（<a href='https://docs.python.org/3/library/functions.html#map'><code>map()</code></a>，<a href='https://docs.python.org/3/library/functions.html#sorted'><code>sorted()</code></a>，<code>itertools.ifilter</code>，...），但是这些操作返回的是一个 <a href='https://docs.python.org/3/library/stdtypes.html#list'><code>list</code></a>或一个迭代器，删除了调用他们的结果的方法和记录集操作的能力。 </p><p>因此，记录集提供这些操作返回记录集本身（如果可能）： </p><p><a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.models.Model.filtered'><code>filtered()</code></a></p><p>返回仅包含满足提供的谓词函数的记录的记录集。谓词也可以是一个字符串，按字段为true或false进行过滤： </p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="Python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#仅保留其公司是当前用户</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">records</span>.<span class="cm-property">filtered</span>(<span class="cm-keyword">lambda</span> <span class="cm-variable">r</span>: <span class="cm-variable">r</span>.<span class="cm-property">company_id</span> == <span class="cm-variable">user</span>.<span class="cm-property">company_id</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#仅保留其合作伙伴是公司</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">records</span>.<span class="cm-property">filtered</span>(<span class="cm-string">"partner_id.is_company"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 130px;"></div><div class="CodeMirror-gutters" style="display: none; height: 130px;"></div></div></div></pre><p><a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.models.Model.sorted'><code>sorted()</code></a></p><p>返回按提供的键函数排序的记录集。如果未提供密钥，请使用模型的默认排序顺序： </p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="Python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 按名称记录排序记录集</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">records</span>.<span class="cm-property">sorted</span>(<span class="cm-variable">key</span>=<span class="cm-keyword">lambda</span> <span class="cm-variable">r</span>: <span class="cm-variable">r</span>.<span class="cm-property">name</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 52px;"></div><div class="CodeMirror-gutters" style="display: none; height: 52px;"></div></div></div></pre><p><a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.models.Model.mapped'><code>mapped()</code></a></p><p>将提供的函数应用于记录集中的每个记录，如果结果是记录集，则返回记录集： </p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="Python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 返回记录集中每条记录的两个字段的汇总列表</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">records</span>.<span class="cm-property">mapped</span>(<span class="cm-keyword">lambda</span> <span class="cm-variable">r</span>: <span class="cm-variable">r</span>.<span class="cm-property">field1</span> <span class="cm-operator">+</span> <span class="cm-variable">r</span>.<span class="cm-property">field2</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 52px;"></div><div class="CodeMirror-gutters" style="display: none; height: 52px;"></div></div></div></pre><p>提供的函数可以是一个字符串来获取字段值： </p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="Python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 返回名称记录列表</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">records</span>.<span class="cm-property">mapped</span>(<span class="cm-string">'name'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#返回合作伙伴记录的记录集</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">record</span>.<span class="cm-property">mapped</span>(<span class="cm-string">'partner_id'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#返回所有合作伙伴银行删除重复记录的并集</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">record</span>.<span class="cm-property">mapped</span>(<span class="cm-string">'partner_id.bank_ids'</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 208px;"></div><div class="CodeMirror-gutters" style="display: none; height: 208px;"></div></div></div></pre><p>&nbsp;</p><h2><a name='header-n51' class='md-header-anchor '></a>环境Environment </h2><p>Environment 由ORM用于存储各种上下文数据：数据库游标cursor （数据库查询），当前用户current user （访问权限检查）和当前的上下文（存储任意元数据）,环境还存储缓存.</p><p>所有记录集都有一个不可变的环境，可以使用<code>env</code>它来访问，并提供对当前user（<code>user</code>），cursor（<code>cr</code>）或context（<code>context</code>）的访问： </p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&gt;&gt;&gt;</span> <span class="cm-variable">records</span>.<span class="cm-property">env</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;</span><span class="cm-variable">Environment</span> <span class="cm-builtin">object</span> ...<span class="cm-operator">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&gt;&gt;&gt;</span> <span class="cm-variable">records</span>.<span class="cm-property">env</span>.<span class="cm-property">user</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">res</span>.<span class="cm-property">user</span>(<span class="cm-number">3</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&gt;&gt;&gt;</span> <span class="cm-variable">records</span>.<span class="cm-property">env</span>.<span class="cm-property">cr</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;</span><span class="cm-variable">Cursor</span> <span class="cm-builtin">object</span> ...<span class="cm-error">)</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 156px;"></div><div class="CodeMirror-gutters" style="display: none; height: 156px;"></div></div></div></pre><p>从其他记录集创建记录集时，将继承环境。环境可用于在其他模型中获取空记录集，并查询该模型： </p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&gt;&gt;&gt;</span> <span class="cm-variable-2">self</span>.<span class="cm-property">env</span>[<span class="cm-string">'res.partner'</span>]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">res</span>.<span class="cm-property">partner</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&gt;&gt;&gt;</span> <span class="cm-variable-2">self</span>.<span class="cm-property">env</span>[<span class="cm-string">'res.partner'</span>].<span class="cm-property">search</span>([[<span class="cm-string">'is_company'</span>, <span class="cm-string">'='</span>, <span class="cm-keyword">True</span>], [<span class="cm-string">'customer'</span>, <span class="cm-string">'='</span>, <span class="cm-keyword">True</span>]])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">res</span>.<span class="cm-property">partner</span>(<span class="cm-number">7</span>, <span class="cm-number">18</span>, <span class="cm-number">12</span>, <span class="cm-number">14</span>, <span class="cm-number">17</span>, <span class="cm-number">19</span>, <span class="cm-number">8</span>, <span class="cm-number">31</span>, <span class="cm-number">26</span>, <span class="cm-number">16</span>, <span class="cm-number">13</span>, <span class="cm-number">20</span>, <span class="cm-number">30</span>, <span class="cm-number">22</span>, <span class="cm-number">29</span>, <span class="cm-number">15</span>, <span class="cm-number">23</span>, <span class="cm-number">28</span>, <span class="cm-number">74</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 104px;"></div><div class="CodeMirror-gutters" style="display: none; height: 104px;"></div></div></div></pre><p>&nbsp;</p><h3><a name='header-n58' class='md-header-anchor '></a>改变环境</h3><p>可以从记录集中自定义环境。这将使用更改的环境返回记录集的新版本。</p><p>sudo()</p><p>使用提供的用户集创建新环境，如果未提供任何用户，则使用管理员（绕过安全上下文中的访问权限/规则），使用新环境返回调用它的记录集的副本：</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># create partner object as administrator以管理员身份创建合作伙伴</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">env</span>[<span class="cm-string">'res.partner'</span>].<span class="cm-property">sudo</span>().<span class="cm-property">create</span>({<span class="cm-string">'name'</span>: <span class="cm-string">"A Partner"</span>})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># list partners visible by the "public" user 列出“公共”用户可见的合作伙伴</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">public</span> = <span class="cm-variable">env</span>.<span class="cm-property">ref</span>(<span class="cm-string">'base.public_user'</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">env</span>[<span class="cm-string">'res.partner'</span>].<span class="cm-property">sudo</span>(<span class="cm-variable">public</span>).<span class="cm-property">search</span>([])</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 156px;"></div><div class="CodeMirror-gutters" style="display: none; height: 156px;"></div></div></div></pre><p>with_context()</p><ol start='' ><li>可以采用单个位置参数，它替换当前环境的上下文</li><li>可以通过关键字获取任意数量的参数，这些参数被添加到当前环境的上下文或步骤1中设置的上下文中</li></ol><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># look for partner, or create one with specified timezone if none is found 查找指定时区的合作伙伴,如果找不到合作伙伴就创建指定时区的合作伙伴</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">env</span>[<span class="cm-string">'res.partner'</span>].<span class="cm-property">with_context</span>(<span class="cm-variable">tz</span>=<span class="cm-variable">a_tz</span>).<span class="cm-property">find_or_create</span>(<span class="cm-variable">email_address</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 78px;"></div><div class="CodeMirror-gutters" style="display: none; height: 78px;"></div></div></div></pre><p>with_env()</p><p>完全取代现有环境</p><p>&nbsp;</p><h2><a name='header-n73' class='md-header-anchor '></a>常见的ORM方法</h2><p>search()</p><p>采用搜索域，返回匹配记录的记录集。可以返回匹配记录（<code>offset</code> 和<code>limit</code>参数）的子集并进行排序（<code>order</code>参数）：</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&gt;&gt;&gt;</span> <span class="cm-comment"># searches the current model</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&gt;&gt;&gt;</span> <span class="cm-variable-2">self</span>.<span class="cm-property">search</span>([(<span class="cm-string">'is_company'</span>, <span class="cm-string">'='</span>, <span class="cm-keyword">True</span>), (<span class="cm-string">'customer'</span>, <span class="cm-string">'='</span>, <span class="cm-keyword">True</span>)])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">res</span>.<span class="cm-property">partner</span>(<span class="cm-number">7</span>, <span class="cm-number">18</span>, <span class="cm-number">12</span>, <span class="cm-number">14</span>, <span class="cm-number">17</span>, <span class="cm-number">19</span>, <span class="cm-number">8</span>, <span class="cm-number">31</span>, <span class="cm-number">26</span>, <span class="cm-number">16</span>, <span class="cm-number">13</span>, <span class="cm-number">20</span>, <span class="cm-number">30</span>, <span class="cm-number">22</span>, <span class="cm-number">29</span>, <span class="cm-number">15</span>, <span class="cm-number">23</span>, <span class="cm-number">28</span>, <span class="cm-number">74</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&gt;&gt;&gt;</span> <span class="cm-variable-2">self</span>.<span class="cm-property">search</span>([(<span class="cm-string">'is_company'</span>, <span class="cm-string">'='</span>, <span class="cm-keyword">True</span>)], <span class="cm-variable">limit</span>=<span class="cm-number">1</span>).<span class="cm-property">name</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">'Agrolait'</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 130px;"></div><div class="CodeMirror-gutters" style="display: none; height: 130px;"></div></div></div></pre><p>只是检查是否有任何记录与域匹配，或者计算使用的记录数 search_count()</p><p>create()</p><p>获取字段值的字典或此类字典的列表，并返回包含所创建记录的记录集： </p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&gt;&gt;&gt;</span> <span class="cm-variable-2">self</span>.<span class="cm-property">create</span>({<span class="cm-string">'name'</span>: <span class="cm-string">"Joe"</span>})</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">res</span>.<span class="cm-property">partner</span>(<span class="cm-number">78</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&gt;&gt;&gt;</span> <span class="cm-variable-2">self</span>.<span class="cm-property">create</span>([{<span class="cm-string">'name'</span>: <span class="cm-string">"Jack"</span>}, {<span class="cm-string">'name'</span>: <span class="cm-string">"William"</span>}, {<span class="cm-string">'name'</span>: <span class="cm-string">"Averell"</span>}])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">res</span>.<span class="cm-property">partner</span>(<span class="cm-number">79</span>, <span class="cm-number">80</span>, <span class="cm-number">81</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 104px;"></div><div class="CodeMirror-gutters" style="display: none; height: 104px;"></div></div></div></pre><p>了解<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#reference-orm-oldapi'>如何使用一个API或另一个API定义方法<code>create</code></a>。 </p><p>write()</p><p>获取许多字段值，将它们写入其记录集中的所有记录。不返回值：</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">self</span>.<span class="cm-property">write</span>({<span class="cm-string">'name'</span>: <span class="cm-string">"Newer Name"</span>})</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 26px;"></div><div class="CodeMirror-gutters" style="display: none; height: 26px;"></div></div></div></pre><p>browse()</p><p>获取数据库ID或id列表并返回记录集，当从外部Odoo获取记录ID（例如，通过外部系统往返）或<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#reference-orm-oldapi'>在旧API中调用方法时</a>非常有用：</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&gt;&gt;&gt;</span> <span class="cm-variable-2">self</span>.<span class="cm-property">browse</span>([<span class="cm-number">7</span>, <span class="cm-number">18</span>, <span class="cm-number">12</span>])</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">res</span>.<span class="cm-property">partner</span>(<span class="cm-number">7</span>, <span class="cm-number">18</span>, <span class="cm-number">12</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 52px;"></div><div class="CodeMirror-gutters" style="display: none; height: 52px;"></div></div></div></pre><p>exists()</p><p>返回仅包含数据库中存在的记录的新记录集。可用于检查记录（例如，从外部获得）是否仍然存在：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n90" mdtype="fences">if not record.exists():
    raise Exception("The record has been deleted")
</pre><p>或者在调用可能删除了一些记录的方法之后： </p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n92" mdtype="fences">records.may_remove_some()
# only keep records which were not deleted仅保留未删除
records = records.exists()
</pre><p>ref()</p><p>环境方法,返回与提供的<a href='https://www.odoo.com/documentation/12.0/glossary.html#term-external-id'>外部id</a>匹配的记录 ： </p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n95" mdtype="fences">&gt;&gt;&gt; env.ref('base.group_public')
res.groups(2)
</pre><p>ensure_one()</p><p>检查记录集是否为单例（仅包含单个记录），否则会引发错误： </p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n98" mdtype="fences">records.ensure_one()
# is equivalent to but clearer than:相当于但更清晰：
assert len(records) == 1, "Expected singleton"
</pre><p>&nbsp;</p><h2><a name='header-n100' class='md-header-anchor '></a>创建模型</h2><p>模型字段定义为模型本身的属性：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n102" mdtype="fences">from odoo import models,fields
class AModel(models.Model):
    _name = 'a.model.name'
    field1 = fields.Char()
#警告 这意味着您无法定义具有相同名称的字段和方法，它们会发生冲突
</pre><p>默认情况下，字段的标签（用户可见名称）是字段名称的大写版本，可以使用以下<code>string</code>参数覆盖：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n104" mdtype="fences">field2 = fields.Integer(string="an other field")
</pre><p>默认值定义为字段上的参数，值为： </p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n106" mdtype="fences">a_field = fields.Char(default="a value")
</pre><p>或者一个被调用来计算默认值的函数，它应返回该值： </p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n108" mdtype="fences">def compute_default_value(self):
    return self.get_value()
a_field = fields.Char(default=compute_default_value)
</pre><p>&nbsp;</p><h3><a name='header-n110' class='md-header-anchor '></a>计算字段</h3><p>可以使用<code>compute</code>参数计算字段（而不是直接从数据库中读取） 。<strong>它必须将计算值分配给字段</strong>。如果它使用其他<em>字段</em>的值，则应使用depends()</p><p>以下命令指定这些字段 ：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n113" mdtype="fences">from odoo import api

total = fields.Float(compute='_compute_total')

@api.depends('value', 'tax')
def _compute_total(self):
    for record in self:
        record.total = record.value + record.value * record.tax
</pre><ul><li>使用子字段时，依赖关系可以是虚线路径： </li></ul><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n117" mdtype="fences">@api.depends('line_ids.value')
def _compute_total(self):
    for record in self:
        record.total = sum(line.value for line in record.line_ids)
</pre><ul><li>默认情况下不会存储计算字段，它们会在请求时计算并返回。设置<code>store=True</code>会将它们存储在数据库中并自动启用搜索</li><li>也可以通过设置<code>search</code> 参数来启用在计算字段上搜索。该值是返回域的方法名称 ：</li></ul><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n123" mdtype="fences">upper_name = field.Char(compute='_compute_upper', search='_search_upper')

def _search_upper(self, operator, value):
    if operator == 'like':
        operator = 'ilike'
    return [('name', operator, value)]
</pre><ul><li>要允许在计算字段上<em>设置</em>值，请使用该<code>inverse</code> 参数。它是反转计算和设置相关字段的函数的名称： </li></ul><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n127" mdtype="fences">document = fields.Char(compute='_get_document', inverse='_set_document')

def _get_document(self):
    for record in self:
        with open(record.get_document_path) as f:
            record.document = f.read()
def _set_document(self):
    for record in self:
        if not record.document: continue
        with open(record.get_document_path()) as f:
            f.write(record.document)
</pre><ul><li>可以通过相同的方法同时计算多个字段，只需在所有字段上使用相同的方法并设置所有字段： </li></ul><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n131" mdtype="fences">discount_value = fields.Float(compute='_apply_discount')
total = fields.Float(compute='_apply_discount')

@depends('value', 'discount')
def _apply_discount(self):
    for record in self:
        # compute actual discount from discount percentage
        discount = record.value * record.discount
        record.discount_value = discount
        record.total = record.value - discount
</pre><p>&nbsp;</p><h3><a name='header-n133' class='md-header-anchor '></a>关联字段</h3><p>计算字段的特殊情况是<em>相关</em>（代理）字段，其提供当前记录上的子字段的值。它们是通过设置<code>related</code>参数来定义的，就像它们可以存储的常规计算字段一样：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n135" mdtype="fences">nickname = fields.Char(related='user_id.partner_id.name', store=True)
</pre><h3><a name='header-n136' class='md-header-anchor '></a>onchange：动态更新UI</h3><p>当用户更改表单中的字段值（但尚未保存表单）时，根据该值自动更新其他字段可能很有用，例如，当税收更改或新发票行更新时更新最终总计添加。</p><ul><li>计算字段会自动检查并重新计算，它们不需要 <code>onchange</code></li><li>对于非计算字段，<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.api.onchange'><code>onchange()</code></a>装饰器用于提供新的字段值：</li></ul><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n143" mdtype="fences">@api.onchange('field1', 'field2') # if these fields are changed, call method
def check_change(self):
    if self.field1 &lt; self.field2:
        self.field3 = True
</pre><ul><li>然后，在方法期间执行的更改将发送到客户端程序并对用户可见</li><li>客户端自动调用计算字段和new-API onchanges，而无需在视图中添加它们</li><li>可以通过<code>on_change=&quot;0&quot;</code>在视图中添加来禁止来自特定字段的触发器 ：</li></ul><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="xml" contenteditable="false" cid="n151" mdtype="fences">&lt;field name="name" on_change="0"/&gt;
</pre><p>当用户编辑字段时，即使有功能字段或显式onchange取决于该字段，也不会触发任何接口更新。 </p><p><code>onchange</code> 方法对虚拟记录的工作分配这些记录不会写入数据库，只是用于知道要将哪个值发送回客户端</p><p>警告 <code>one2many</code>或<code>many2many</code>field 不可能通过onchange修改自身。这是webclient限制 - 请参阅<a href='https://github.com/odoo/odoo/issues/2693'>＃2693</a></p><h3><a name='header-n155' class='md-header-anchor '></a>低级SQL</h3><p>在<code>cr</code>上的环境属性是光标用于当前数据库事务，并允许直接执行的SQL，无论是对查询其难以用ORM来表达（例如复杂的连接），或者出于性能的原因：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n157" mdtype="fences">self.env.cr.execute("some_sql", param1, param2, param3)
</pre><p>由于模型使用相同的游标并<code>Environment</code> 保存各种缓存，因此在原始SQL中<em>更改</em>数据库时，这些缓存必须无效，否则模型的进一步使用可能会变得不连贯。在使用时<code>CREATE</code>，<code>UPDATE</code>或<code>DELETE</code>在SQL中，有必要清除缓存，而不是<code>SELECT</code>（只是读取数据库）。</p><p>可以使用对象的<code>invalidate_cache()</code>方法 来执行清除高速缓存 <code>BaseModel</code>。</p><p>&nbsp;</p><h3><a name='header-n161' class='md-header-anchor '></a>CRUD</h3><h6><a name='header-n162' class='md-header-anchor '></a><code>create(vals_list) → records</code></h6><p>为模型创建新记录。</p><p>新记录使用dicts列表中的值进行初始化 <code>vals_list</code>，如果需要，可以使用<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.models.Model.default_get'><code>default_get()</code></a>。</p><p>参数</p><p><span>	</span>vals_list（<code>list</code>） -</p><p>模型字段的值，作为字典列表：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n168" mdtype="fences">[{ 'field_name' ： field_value ， ... }， ... ]
</pre><p>为了向后兼容，<code>vals_list</code>可能是字典。它被视为单例列表<code>[vals]</code>，并返回单个记录。</p><p>看<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.models.Model.write'><code>write()</code></a>详情</p><p>返回</p><p>创建的记录</p><p>加薪</p><ul><li><p><strong>AccessError</strong></p><p>-</p><ul><li>如果用户对请求的对象没有创建权限</li><li>如果用户尝试绕过请求对象上的create的访问规则</li></ul></li><li><p><strong>ValidateError</strong> - 如果用户尝试为不在选择中的字段输入无效值</p></li><li><p><a href='https://www.odoo.com/documentation/12.0/webservices/iap.html#odoo.exceptions.UserError'><strong>UserError</strong></a> - 如果在对象层次结构中创建循环操作的结果（例如将对象设置为其自己的父对象）</p></li></ul><h6><a name='header-n187' class='md-header-anchor '></a><code>browse([*ids*]) → records</code></h6><p>返回当前环境中作为参数提供的ID的记录集。</p><p>不能使用任何ID，单个ID或一系列ID。</p><h6><a name='header-n190' class='md-header-anchor '></a><code>unlink()</code></h6><p>删除当前集的记录</p><p>加薪</p><ul><li><p><strong>AccessError</strong></p><p>-</p><ul><li>如果用户对请求的对象没有取消链接权限</li><li>如果用户试图绕过请求对象上取消链接的访问规则</li></ul></li><li><p><a href='https://www.odoo.com/documentation/12.0/webservices/iap.html#odoo.exceptions.UserError'><strong>UserError</strong></a> - 如果记录是其他记录的默认属性</p></li></ul><h6><a name='header-n204' class='md-header-anchor '></a><code>write(*vals*)</code></h6><p>使用提供的值更新当前集中的所有记录。</p><p>参数</p><p>vals</p><p>（</p><p><code>dict</code></p><p>） -</p><p>要更新的字段和要在其上设置的值，例如：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n212" mdtype="fences">{ 'foo' ： 1 ， 'bar' ： “Qux” }
</pre><p>将字段设置<code>foo</code>为<code>1</code>和字段<code>bar</code>为 <code>&quot;Qux&quot;</code>if如果它们是有效的（否则它将触发错误）。</p><p>加薪</p><ul><li><p><strong>AccessError</strong></p><p>-</p><ul><li>如果用户对请求的对象没有写权限</li><li>如果用户试图绕过访问规则以写入所请求的对象</li></ul></li><li><p><strong>ValidateError</strong> - 如果用户尝试为不在选择中的字段输入无效值</p></li><li><p><a href='https://www.odoo.com/documentation/12.0/webservices/iap.html#odoo.exceptions.UserError'><strong>UserError</strong></a> - 如果在对象层次结构中创建循环操作的结果（例如将对象设置为其自己的父对象）</p></li><li><p>对于数字字段（<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.fields.Integer'><code>Integer</code></a>， <a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.fields.Float'><code>Float</code></a>），值应为相应的类型</p></li><li><p>因为<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.fields.Boolean'><code>Boolean</code></a>，值应为a <a href='https://docs.python.org/3/library/functions.html#bool'><code>bool</code></a></p></li><li><p>对于<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.fields.Selection'><code>Selection</code></a>，值应与选择值匹配（通常<a href='https://docs.python.org/3/library/stdtypes.html#str'><code>str</code></a>，有时 <a href='https://docs.python.org/3/library/functions.html#int'><code>int</code></a>）</p></li><li><p>对于<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.fields.Many2one'><code>Many2one</code></a>，该值应该是要设置的记录的数据库标识符</p></li><li><p>其他非关系字段使用字符串作为值</p></li><li><p>历史和兼容性的原因， <a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.fields.Date'><code>Date</code></a>和 <a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.fields.Datetime'><code>Datetime</code></a>字段使用字符串作为值（写入和读出），而不是<a href='https://docs.python.org/3/library/datetime.html#datetime.date'><code>date</code></a>或 <a href='https://docs.python.org/3/library/datetime.html#datetime.datetime'><code>datetime</code></a>。这些日期字符串是UTC，仅其格式<code>odoo.tools.misc.DEFAULT_SERVER_DATE_FORMAT</code>和<code>odoo.tools.misc.DEFAULT_SERVER_DATETIME_FORMAT</code></p></li><li><p><a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.fields.One2many'><code>One2many</code></a>并 <a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.fields.Many2many'><code>Many2many</code></a>使用特殊的“命令”格式来操作存储在字段中/与字段相关联的记录集。</p><p>此格式是按顺序执行的三元组列表，其中每个三元组是在记录集上执行的命令。并非所有命令都适用于所有情况。可能的命令是：</p><ul><li><p><code>(0, _, values)</code></p><p>添加从提供的<code>value</code>词典创建的新记录。</p></li><li><p><code>(1, id, values)</code></p><p><code>id</code>使用中的值 更新现有id的记录<code>values</code>。不能用于<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.models.Model.create'><code>create()</code></a>。</p></li><li><p><code>(2, id, _)</code></p><p><code>id</code>从集合中删除id的记录，然后删除它（从数据库中）。不能用于<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.models.Model.create'><code>create()</code></a>。</p></li><li><p><code>(3, id, _)</code></p><p><code>id</code>从集合中删除id的记录，但不删除它。不能用 <a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.fields.One2many'><code>One2many</code></a>。不能用于 <a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.models.Model.create'><code>create()</code></a>。</p></li><li><p><code>(4, id, _)</code></p><p>将id的现有记录添加<code>id</code>到集合中。不能用<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.fields.One2many'><code>One2many</code></a>。</p></li><li><p><code>(5, _, _)</code></p><p>从集合中删除所有记录，相当于<code>3</code>明确地在每条记录上使用该命令。不能用<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.fields.One2many'><code>One2many</code></a>。不能用于 <a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.models.Model.create'><code>create()</code></a>。</p></li><li><p><code>(6, _, ids)</code></p><p>替换由集合中的所有现有的记录<code>ids</code>列表，等同于使用该命令<code>5</code>，然后命令 <code>4</code>每个<code>id</code>中<code>ids</code>。</p></li></ul><p>标记为<code>_</code>上面列表中的值将被忽略，并且可以是任何内容，通常<code>0</code>或<code>False</code>。</p></li></ul><h6><a name='header-n266' class='md-header-anchor '></a><code>read([*fields*])</code></h6><p>在<code>self</code>低级/ RPC方法中读取记录的请求字段。在Python代码中，首选<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.models.Model.browse'><code>browse()</code></a>。</p><p>参数</p><p><strong>fields</strong> - 要返回的字段名称列表（默认为所有字段）</p><p>返回</p><p>将字段名称映射到其值的字典列表，每个记录使用一个字典</p><p>加薪</p><p><a href='https://www.odoo.com/documentation/12.0/webservices/iap.html#odoo.exceptions.AccessError'><strong>AccessError</strong></a> - 如果用户对某些给定记录没有读取权限</p><h6><a name='header-n274' class='md-header-anchor '></a><code>read_group(*domain*, *fields*, *groupby*, *offset=0*, *limit=None*, *orderby=False*, *lazy=True*)</code></h6><p>获取按给定<code>groupby</code>字段分组的列表视图中的记录列表</p><p>参数</p><ul><li><strong>domain</strong> - 列出指定搜索条件的列表[[&#39;field_name&#39;，&#39;operator&#39;，&#39;value&#39;]，...]</li><li><strong>fields</strong>（<a href='https://docs.python.org/3/library/stdtypes.html#list'><code>list</code></a>） - 在对象上指定的列表视图中存在的字段列表。每个元素都是&#39;field&#39;（字段名称，使用默认聚合）或&#39;field：agg&#39;（聚合字段聚合函数&#39;agg&#39;）或&#39;name：agg（field）&#39;（聚合字段带&#39;agg&#39;）并将其作为“名称”返回）。可能的聚合函数是PostgreSQL（<a href='https://www.postgresql.org/docs/current/static/functions-aggregate.html' target='_blank' class='url'>https://www.postgresql.org/docs/current/static/functions-aggregate.html</a>）和&#39;count_distinct&#39;提供的函数，具有预期的含义。</li><li><strong>groupby</strong>（<a href='https://docs.python.org/3/library/stdtypes.html#list'><code>list</code></a>） - 将记录分组的groupby描述列表。groupby描述是字段（然后它将按该字段分组）或字符串&#39;field：groupby_function&#39;。目前，支持的唯一功能是“日”，“周”，“月”，“季度”或“年”，它们只适用于日期/日期时间字段。</li><li><strong>offset</strong>（<a href='https://docs.python.org/3/library/functions.html#int'><code>int</code></a>） - 要跳过的可选记录数</li><li><strong>limit</strong>（<a href='https://docs.python.org/3/library/functions.html#int'><code>int</code></a>） - 可选的最大返回记录数</li><li><strong>orderby</strong>（<a href='https://docs.python.org/3/library/stdtypes.html#list'><code>list</code></a>） - 可选<code>order by</code>规范，用于覆盖组的自然排序顺序，另请参阅<code>search()</code> （仅支持当前的多个字段）</li><li><strong>lazy</strong>（<a href='https://docs.python.org/3/library/functions.html#bool'><code>bool</code></a>） - 如果为true，则结果仅按第一个groupby分组，其余的groupbys放在__context键中。如果为false，则所有groupbys都在一次调用中完成。</li></ul><p>返回</p><p>字典列表（每个记录一个字典）包含：</p><ul><li>按<code>groupby</code>参数中的字段分组的字段值</li><li>__domain：指定搜索条件的元组列表</li><li>__context：带参数的字典 <code>groupby</code></li></ul><p>返回类型</p><p>[{&#39;field_name_1&#39;：值，..]</p><p>加薪</p><p><strong>AccessError</strong></p><p> -</p><ul><li>如果用户对请求的对象没有读取权限</li><li>如果用户试图绕过访问规则以读取请求的对象</li></ul><h3><a name='header-n311' class='md-header-anchor '></a>搜索</h3><h6><a name='header-n312' class='md-header-anchor '></a><code>search(*args[, offset=0][, limit=None][, order=None][, count=False]*)</code></h6><p>根据<code>args</code> <a href='https://www.odoo.com/documentation/12.0/reference/orm.html#reference-orm-domains'>搜索域</a>搜索记录。</p><p>参数</p><ul><li><strong>args</strong> - <a href='https://www.odoo.com/documentation/12.0/reference/orm.html#reference-orm-domains'>搜索域</a>。使用空列表匹配所有记录。</li><li><strong>offset</strong>（<a href='https://docs.python.org/3/library/functions.html#int'><code>int</code></a>） - 要忽略的结果数（默认值：无）</li><li><strong>limit</strong>（<a href='https://docs.python.org/3/library/functions.html#int'><code>int</code></a>） - 要返回的最大记录数（默认值：全部）</li><li><strong>order</strong>（<a href='https://docs.python.org/3/library/stdtypes.html#str'><code>str</code></a>） - 排序字符串</li><li><strong>count</strong>（<a href='https://docs.python.org/3/library/functions.html#bool'><code>bool</code></a>） - 如果为True，则只计算并返回匹配记录的数量（默认值：False）</li></ul><p>返回</p><p>最多<code>limit</code>匹配搜索条件的记录</p><p>加薪</p><p><strong>AccessError</strong></p><p> -</p><ul><li>如果用户试图绕过访问规则以读取请求的对象。</li></ul><h6><a name='header-n334' class='md-header-anchor '></a><code>search_count(*args*) → int</code></h6><p>返回与<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#reference-orm-domains'>提供的域</a>匹配<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#reference-orm-domains'>的</a>当前模型中的记录数。</p><h6><a name='header-n336' class='md-header-anchor '></a><code>name_search(*name=&#39;&#39;*, *args=None*, *operator=&#39;ilike&#39;*, *limit=100*) → records</code></h6><p>搜索与给定<code>name</code>模式相比具有与给定模式匹配的显示名称的记录 <code>operator</code>，同时还匹配可选搜索域（<code>args</code>）。</p><p>这用于例如基于关系字段的部分值来提供建议。有时被视为反函数<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.models.Model.name_get'><code>name_get()</code></a>，但不能保证。</p><p>此方法相当于<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.models.Model.search'><code>search()</code></a>使用基于搜索结果的搜索域进行调用，<code>display_name</code>然后<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.models.Model.name_get'><code>name_get()</code></a>搜索结果。</p><p>参数</p><ul><li><strong>name</strong>（<a href='https://docs.python.org/3/library/stdtypes.html#str'><code>str</code></a>） - 要匹配的名称模式</li><li><strong>args</strong>（<a href='https://docs.python.org/3/library/stdtypes.html#list'><code>list</code></a>） - 可选的搜索域（参见<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.models.Model.search'><code>search()</code></a>语法），指定进一步的限制</li><li><strong>operator</strong>（<a href='https://docs.python.org/3/library/stdtypes.html#str'><code>str</code></a>） - 用于匹配的域运算符<code>name</code>，例如 <code>&#39;like&#39;</code>或<code>&#39;=&#39;</code>。</li><li><strong>limit</strong>（<a href='https://docs.python.org/3/library/functions.html#int'><code>int</code></a>） - 可选的最大返回记录数</li></ul><p>返回类型</p><p><a href='https://docs.python.org/3/library/stdtypes.html#list'>名单</a></p><p>返回</p><p><code>(id, text_repr)</code>所有匹配记录的对列表。</p><h3><a name='header-n354' class='md-header-anchor '></a>记录集操作</h3><h6><a name='header-n355' class='md-header-anchor '></a><code>ids</code></h6><p>此记录集中的实际记录ID列表（忽略要创建的记录的占位符ID）</p><h6><a name='header-n357' class='md-header-anchor '></a><code>ensure_one()</code></h6><p>验证当前的recorset是否包含单个记录。否则会引发异常。</p><h6><a name='header-n359' class='md-header-anchor '></a><code>exists() → records</code></h6><p>返回<code>self</code>存在的记录子集，并在缓存中标记已删除的记录。它可以用作记录的测试：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n361" mdtype="fences">如果 记录。exists （）：
    ...
</pre><p>按照惯例，新记录将作为现有记录返回。</p><h6><a name='header-n363' class='md-header-anchor '></a><code>filtered(*func*)</code></h6><p>在选择的记录<code>self</code>，从而<code>func(rec)</code>为真，并返回它们作为一个记录。</p><p>参数</p><p><strong>func</strong> - 字段名称的函数或点分隔序列</p><h6><a name='header-n367' class='md-header-anchor '></a><code>sorted(*key=None*, *reverse=False*)</code></h6><p>返回<code>self</code>订购的记录集<code>key</code>。</p><p>参数</p><ul><li><strong>key</strong> - 返回每个记录的比较键的一个参数的函数，或字段名称，或者<code>None</code>，在这种情况下，记录按照默认模型的顺序排序</li><li><strong>反向</strong> - 如果<code>True</code>，以相反的顺序返回结果</li></ul><h6><a name='header-n375' class='md-header-anchor '></a><code>mapped(*func*)</code></h6><p>应用于<code>func</code>所有记录<code>self</code>，并将结果作为列表或记录集（如果<code>func</code>返回记录集）返回。在后一种情况下，返回的记录集的顺序是任意的。</p><p>参数</p><p><strong>func</strong> - 一个函数或以点分隔的字段名称序列（字符串）; 任何falsy值只返回记录集<code>self</code></p><h3><a name='header-n379' class='md-header-anchor '></a>环境交换</h3><h6><a name='header-n380' class='md-header-anchor '></a><code>sudo([*user=SUPERUSER*])</code></h6><p>返回附加到提供的用户的此记录集的新版本。</p><p>默认情况下，它返回一个<code>SUPERUSER</code>记录集，其中绕过访问控制和记录规则。</p><p>使用<code>sudo</code>可能导致数据访问跨越记录规则的边界，可能混合要隔离的记录（例如，来自多公司环境中的不同公司的记录）。</p><p>这可能会导致在多种方法中选择一条记录的方法产生不直观的结果 - 例如获取默认公司或选择物料清单。</p><p>由于必须重新评估记录规则和访问控制，因此新记录集不会从当前环境的数据高速缓存中受益，因此以后的数据访问可能会在从数据库重新获取时产生额外的延迟。返回的记录集具有与之相同的预取对象<code>self</code>。</p><h6><a name='header-n386' class='md-header-anchor '></a><code>with_context(*[context][, \**overrides]*) → records</code></h6><p>返回附加到扩展上下文的此记录集的新版本。</p><p>扩展上下文要么是合并提供的<code>context</code>， 要么<code>overrides</code>合并<em>当前</em>上下文， <code>overrides</code>例如：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n389" mdtype="fences">#current context is {'key1'：True} 
r2  =  records 。with_context （{}， key2 = True ）
＃ - &gt; r2._context是{'key2'：True} 
r2  =  记录。with_context （key2 = True ）
＃ - &gt; r2._context是{'key1'：True，'key2'：True}
</pre><h6><a name='header-n390' class='md-header-anchor '></a><code>with_env(*env*)</code></h6><p>返回附加到提供的环境的此记录集的新版本</p><h3><a name='header-n392' class='md-header-anchor '></a>警告</h3><p>新环境不会受益于当前环境的数据缓存，因此以后的数据访问可能会在从数据库重新获取时产生额外的延迟。返回的记录集具有与之相同的预取对象<code>self</code>。</p><h3><a name='header-n394' class='md-header-anchor '></a>字段和视图查询</h3><h6><a name='header-n395' class='md-header-anchor '></a><code>fields_get(*[fields][, attributes]*)</code></h6><p>返回每个字段的定义。</p><p>返回的值是字典的字典（由字段名称指示）。_inherits&#39;d字段包括在内。字符串，帮助和选择（如果存在）属性已翻译。</p><p>参数</p><ul><li><strong>allfields</strong> - 要记录的字段列表，全部为空或未提供</li><li><strong>attributes</strong> - 要为每个字段返回的描述属性列表，如果为空或未提供则全部</li></ul><h6><a name='header-n404' class='md-header-anchor '></a><code>fields_view_get([*view_id | view_type=&#39;form&#39;*])</code></h6><p>获取所请求视图的详细组成，如字段，模型，视图体系结构</p><p>参数</p><ul><li><strong>view_id</strong> - 视图的id或None</li><li><strong>view_type</strong> - 如果view_id为None（&#39;form&#39;，&#39;tree&#39;，...）则返回的视图的类型</li><li><strong>toolbar</strong> - 如果包含上下文操作，则为true</li><li><strong>子菜单</strong> - 已弃用</li></ul><p>返回</p><p>描述所请求视图组成的字典（包括继承的视图和扩展）</p><p>加薪</p><ul><li><p><strong>AttributeError</strong></p><p>-</p><ul><li>如果继承的视图具有未知的位置，可以使用“之前”，“之后”，“内部”，“替换”以外的其他视图</li><li>如果在父视图中找到“position”以外的某些标记</li></ul></li><li><p><strong>无效的ArchitectureError</strong> - 如果在结构上定义了除窗体，树，日历，搜索等之外的视图类型</p></li></ul><h3><a name='header-n430' class='md-header-anchor '></a>杂项方法</h3><h6><a name='header-n431' class='md-header-anchor '></a><code>default_get(*fields*) → default_values</code></h6><p>返回字段中的默认值<code>fields_list</code>。默认值由上下文，用户默认值和模型本身确定。</p><p>参数</p><p><strong>fields_list</strong> - 字段名称列表</p><p>返回</p><p>将每个字段名称映射到其对应的默认值的字典（如果有的话）。</p><h6><a name='header-n437' class='md-header-anchor '></a><code>copy(*default=None*)</code></h6><p>重复记录<code>self</code>使用默认值更新它</p><p>参数</p><p><strong>default</strong>（<a href='https://docs.python.org/3/library/stdtypes.html#dict'><code>dict</code></a>） - 要在复制记录的原始值中覆盖的字段值字典，例如：<code>{&#39;field_name&#39;: overridden_value, ...}</code></p><p>返回</p><p>新纪录</p><h6><a name='header-n443' class='md-header-anchor '></a><code>name_get() → [(id, name), ...]</code></h6><p>返回记录中的文本表示<code>self</code>。默认情况下，这是<code>display_name</code>字段的值。</p><p>返回</p><p><code>(id, text_repr)</code>每条记录的对列表</p><p>返回类型</p><p><a href='https://docs.python.org/3/library/stdtypes.html#list'>列表</a>（<a href='https://docs.python.org/3/library/stdtypes.html#tuple'>元组</a>）</p><h6><a name='header-n449' class='md-header-anchor '></a><code>name_create(*name*) → record</code></h6><p>通过<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.models.Model.create'><code>create()</code></a>仅提供一个值来调用创建新记录：新记录的显示名称。</p><p>新记录将使用适用于此模型的任何默认值进行初始化，或通过上下文提供。通常的行为<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.models.Model.create'><code>create()</code></a>适用。</p><p>参数</p><p><strong>name</strong> - 要创建的记录的显示名称</p><p>返回类型</p><p><a href='https://docs.python.org/3/library/stdtypes.html#tuple'>元组</a></p><p>返回</p><p><a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.models.Model.name_get'><code>name_get()</code></a>创建记录的对值</p><p>&nbsp;</p><h3><a name='header-n459' class='md-header-anchor '></a>自动字段</h3><h6><a name='header-n460' class='md-header-anchor '></a><code>id</code>  <span>	</span></h6><p><span>	</span>识别field</p><h6><a name='header-n462' class='md-header-anchor '></a><code>_log_access</code></h6><p><span>	</span>无论日志的访问域（<code>create_date</code>，<code>write_uid</code>，...）应生成（默认值：<code>True</code>）</p><h6><a name='header-n464' class='md-header-anchor '></a><code>create_date</code></h6><p><span>	</span>创建记录的日期</p><p><span>	</span>类型</p><p><span>		</span><code>Datetime</code></p><h6><a name='header-n468' class='md-header-anchor '></a><code>create_uid</code></h6><p><span>	</span>创建记录的用户的关系字段</p><p><span>	</span>类型</p><p><span>		</span><code>res.users</code></p><h6><a name='header-n472' class='md-header-anchor '></a><code>write_date</code></h6><p><span>	</span>上次修改记录的日期</p><p><span>	</span>类型</p><p><span>		</span><code>Datetime</code></p><h6><a name='header-n476' class='md-header-anchor '></a><code>write_uid</code></h6><p><span>	</span>修改记录的最后一个用户的关系字段</p><p><span>	</span>类型</p><p><span>		</span><code>res.users</code></p><p>&nbsp;</p><h2><a name='header-n481' class='md-header-anchor '></a>字段</h2><h3><a name='header-n482' class='md-header-anchor '></a>基本领域</h3><h6><a name='header-n483' class='md-header-anchor '></a><code>class odoo.fields.Field(string=&lt;object object&gt;, **kwargs)</code></h6><p>字段描述符包含字段定义，并管理记录上相应字段的访问和分配。在实例化字段时可能会提供以下属性：</p><p>参数</p><ul><li><strong>string</strong> - 用户看到的字段的标签（字符串）; 如果未设置，ORM将获取类中的字段名称（大写）。</li><li><strong>help</strong> - 用户看到的字段的工具提示（字符串）</li><li><strong>readonly</strong> - 字段是否为readonly（默认为boolean <code>False</code>）</li><li><strong>required</strong> - 是否<strong>需要</strong>字段的值（默认为boolean <code>False</code>）</li><li><strong>index</strong> - 字段是否在数据库中建立索引（默认为布尔值<code>False</code>）</li><li><strong>default</strong> - 字段的默认值; 这可以是静态值，也可以是记录集并返回值的函数; 用于 <code>default=None</code>丢弃该字段的默认值</li><li><strong>states</strong> - 将状态值映射到UI属性 - 值对列表的字典; 可能的属性是：&#39;readonly&#39;，&#39;required&#39;，&#39;invisible&#39;。注意：任何基于状态的条件都要求<code>state</code>在客户端UI上提供字段值。这通常通过将其包括在相关视图中来完成，如果与最终用户不相关，则可能使其不可见。</li><li><strong>groups</strong> - 以逗号分隔的组xml id列表（字符串）; 这限制了仅对给定组的用户的字段访问</li><li><strong>copy</strong>（<a href='https://docs.python.org/3/library/functions.html#bool'><code>bool</code></a>） - 是否应在复制记录时复制字段值（默认值：<code>True</code>对于普通字段，<code>False</code>对于 <code>one2many</code>和计算字段，包括属性字段和相关字段）</li><li><strong>oldname</strong>（<code>string</code>） - 此字段的先前名称，以便ORM可以在迁移时自动重命名</li></ul><h4><a name='header-n507' class='md-header-anchor '></a>计算字段</h4><p>可以定义一个字段，其值是计算的，而不是简单地从数据库中读取。下面给出了特定于计算字段的属性。要定义此类字段，只需为该属性提供值即可<code>compute</code>。</p><p>参数</p><ul><li><strong>compute</strong> - 计算字段的方法的名称</li><li><strong>inverse</strong> - 反转字段的方法的名称（可选）</li><li><strong>search</strong> - 在字段上实现搜索的方法的名称（可选）</li><li><strong>store</strong> - 字段是否存储在数据库中（默认情况下，<code>False</code>在计算字段上为boolean ）</li><li><strong>compute_sudo</strong> - 是否应将该字段重新计算为超级用户以绕过访问权限（默认为布尔值<code>False</code>）请注意，这对非存储的计算字段没有影响</li></ul><p>对于给定的方法<code>compute</code>，<code>inverse</code>并<code>search</code>在模型的方法。它们的签名如下例所示：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="python" contenteditable="false" cid="n522" mdtype="fences" style="break-inside: unset;">upper = fields.Char(compute='_compute_upper',
                    inverse='_inverse_upper',
                    search='_search_upper')

@api.depends('name')
def _compute_upper(self):
    for rec in self:
        rec.upper = rec.name.upper() if rec.name else False

def _inverse_upper(self):
    for rec in self:
        rec.name = rec.upper.lower() if rec.upper else False

def _search_upper(self, operator, value):
    if operator == 'like':
        operator = 'ilike'
    return [('name', operator, value)]
</pre><p>compute方法必须在调用的记录集的所有记录上分配字段。<a href='https://www.odoo.com/documentation/12.0/reference/orm.html#odoo.api.depends'><code>odoo.api.depends()</code></a>必须在compute方法上应用装饰器来指定字段依赖性; 这些依赖关系用于确定何时重新计算字段; 重新计算是自动的，并保证缓存/数据库的一致性。请注意，相同的方法可用于多个字段，您只需分配方法中的所有给定字段; 对于所有这些字段，将调用该方法一次。</p><p>默认情况下，计算字段不会存储到数据库中，而是即时计算。添加属性<code>store=True</code>会将字段的值存储在数据库中。存储字段的优点是在该字段上搜索由数据库本身完成。缺点是在必须重新计算字段时需要数据库更新。</p><p>inverse正如其名称所示，反向方法执行计算方法的反转：调用的记录具有字段的值，您必须对字段依赖项应用必要的更改，以便计算给出预期值。请注意，默认情况下，只读取没有逆方法的计算字段。</p><p>在对模型进行实际搜索之前处理域时会调用搜索方法。它必须返回一个等同于条件的域：<code>field operator value</code>。</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p></div>
</body>
</html>