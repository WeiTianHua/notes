<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>docker</title>

<link href='/css/base.dark.css' rel='stylesheet' type='text/css' />
<link href='/css/github.dark.css' rel='stylesheet' type='text/css' />
<script src="/js/change_zhuti.js"></script>
<script src="/js/click_start.js"></script>

</head>
<body class='typora-export os-windows' >
<div  id='write'  class = 'is-node'><div class='md-toc' mdtype='toc'><p class="md-toc-content"><span class="md-toc-item md-toc-h2" data-ref="n4"><a class="md-toc-inner" href="#header-n4">安装Docker</a></span><span class="md-toc-item md-toc-h3" data-ref="n5"><a class="md-toc-inner" href="#header-n5">Ubuntu 16.04</a></span><span class="md-toc-item md-toc-h2" data-ref="n23"><a class="md-toc-inner" href="#header-n23">Docker 配置文件</a></span><span class="md-toc-item md-toc-h3" data-ref="n24"><a class="md-toc-inner" href="#header-n24">/etc/docker/daemon.json</a></span><span class="md-toc-item md-toc-h2" data-ref="n53"><a class="md-toc-inner" href="#header-n53">运行容器</a></span><span class="md-toc-item md-toc-h3" data-ref="n54"><a class="md-toc-inner" href="#header-n54">要使用root权限<span>	</span>docker run*</a></span><span class="md-toc-item md-toc-h3" data-ref="n69"><a class="md-toc-inner" href="#header-n69">运行交互式的容器<span>	</span>docker run -i -t</a></span><span class="md-toc-item md-toc-h3" data-ref="n81"><a class="md-toc-inner" href="#header-n81">-v挂载主机上的文件到容器</a></span><span class="md-toc-item md-toc-h3" data-ref="n90"><a class="md-toc-inner" href="#header-n90">启动容器（后台模式）docker run -d </a></span><span class="md-toc-item md-toc-h2" data-ref="n97"><a class="md-toc-inner" href="#header-n97">查看容器列表<span>	</span>docker ps</a></span><span class="md-toc-item md-toc-h2" data-ref="n103"><a class="md-toc-inner" href="#header-n103">查看容器运行记录</a></span><span class="md-toc-item md-toc-h4" data-ref="n105"><a class="md-toc-inner" href="#header-n105">在容器内使用docker logs命令，查看容器内的标准输出,参数为  id   或  容器名字</a></span><span class="md-toc-item md-toc-h2" data-ref="n108"><a class="md-toc-inner" href="#header-n108">进入容器</a></span><span class="md-toc-item md-toc-h2" data-ref="n113"><a class="md-toc-inner" href="#header-n113">停止容器<span>	</span>docker stop</a></span><span class="md-toc-item md-toc-h2" data-ref="n117"><a class="md-toc-inner" href="#header-n117">Docker 客户端</a></span><span class="md-toc-item md-toc-h3" data-ref="n123"><a class="md-toc-inner" href="#header-n123"><strong>-P :</strong>将容器内部使用的网络端口映射到我们使用的主机上。</a></span><span class="md-toc-item md-toc-h3" data-ref="n138"><a class="md-toc-inner" href="#header-n138">使用 <strong>docker port</strong> 可以查看指定 （ID 或者名字）容器的某个确定端口映射到宿主机的端口号。</a></span><span class="md-toc-item md-toc-h2" data-ref="n146"><a class="md-toc-inner" href="#header-n146">查看 WEB 应用程序日志</a></span><span class="md-toc-item md-toc-h2" data-ref="n150"><a class="md-toc-inner" href="#header-n150">检查 WEB 应用程序</a></span><span class="md-toc-item md-toc-h2" data-ref="n154"><a class="md-toc-inner" href="#header-n154">停止 WEB 应用容器</a></span><span class="md-toc-item md-toc-h2" data-ref="n157"><a class="md-toc-inner" href="#header-n157">重启WEB应用容器</a></span><span class="md-toc-item md-toc-h2" data-ref="n162"><a class="md-toc-inner" href="#header-n162">正在运行的容器，我们可以使用 docker restart 命令来重启</a></span><span class="md-toc-item md-toc-h2" data-ref="n164"><a class="md-toc-inner" href="#header-n164">移除WEB应用容器</a></span><span class="md-toc-item md-toc-h3" data-ref="n165"><a class="md-toc-inner" href="#header-n165">我们可以使用 docker rm 命令来删除不需要的容器</a></span><span class="md-toc-item md-toc-h4" data-ref="n167"><a class="md-toc-inner" href="#header-n167">删除容器时，容器必须是停止状态，否则会报如下错误</a></span><span class="md-toc-item md-toc-h1" data-ref="n170"><a class="md-toc-inner" href="#header-n170">Docker 镜像使用</a></span><span class="md-toc-item md-toc-h2" data-ref="n172"><a class="md-toc-inner" href="#header-n172">列出镜像列表</a></span><span class="md-toc-item md-toc-h2" data-ref="n191"><a class="md-toc-inner" href="#header-n191">获取一个新的镜像<span>	</span>docker pull </a></span><span class="md-toc-item md-toc-h2" data-ref="n194"><a class="md-toc-inner" href="#header-n194">查找镜像</a></span><span class="md-toc-item md-toc-h2" data-ref="n202"><a class="md-toc-inner" href="#header-n202">创建镜像</a></span><span class="md-toc-item md-toc-h3" data-ref="n209"><a class="md-toc-inner" href="#header-n209">更新镜像</a></span><span class="md-toc-item md-toc-h3" data-ref="n231"><a class="md-toc-inner" href="#header-n231">构建镜像</a></span><span class="md-toc-item md-toc-h2" data-ref="n235"><a class="md-toc-inner" href="#header-n235">Dockerfile的基本结构</a></span><span class="md-toc-item md-toc-h4" data-ref="n241"><a class="md-toc-inner" href="#header-n241">RUN 指令告诉docker 在镜像内执行命令，安装了什么。。。</a></span><span class="md-toc-item md-toc-h3" data-ref="n271"><a class="md-toc-inner" href="#header-n271">然后，我们使用 Dockerfile 文件，通过 docker build 命令来构建一个镜像。</a></span><span class="md-toc-item md-toc-h2" data-ref="n281"><a class="md-toc-inner" href="#header-n281">设置镜像标签</a></span><span class="md-toc-item md-toc-h2" data-ref="n285"><a class="md-toc-inner" href="#header-n285">删除指定的镜像</a></span><span class="md-toc-item md-toc-h2" data-ref="n287"><a class="md-toc-inner" href="#header-n287">修改镜像</a></span><span class="md-toc-item md-toc-h2" data-ref="n292"><a class="md-toc-inner" href="#header-n292">保存修改的镜像到本地镜像库</a></span><span class="md-toc-item md-toc-h1" data-ref="n295"><a class="md-toc-inner" href="#header-n295">Docker 容器连接</a></span><span class="md-toc-item md-toc-h3" data-ref="n299"><a class="md-toc-inner" href="#header-n299">容器命名</a></span><span class="md-toc-item md-toc-h2" data-ref="n303"><a class="md-toc-inner" href="#header-n303"><strong>搭建自己的Dockers Registry</strong></a></span><span class="md-toc-item md-toc-h1" data-ref="n323"><a class="md-toc-inner" href="#header-n323">docker镜像导入导出</a></span></p></div><p>&nbsp;</p><p>&nbsp;</p><h2><a name='header-n4' class='md-header-anchor '></a>安装Docker</h2><h3><a name='header-n5' class='md-header-anchor '></a>Ubuntu 16.04</h3><p>1.选择国内的云服务商，这里选择阿里云为例</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="powershell"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="powershell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 3.60004px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">curl</span> <span class="cm-operator">-</span><span class="cm-identifier">sSL</span> <span class="cm-identifier">http</span><span class="cm-operator">://</span><span class="cm-identifier">acs-public-mirror</span><span class="cm-punctuation">.</span><span class="cm-identifier">oss-cn-hangzhou</span><span class="cm-punctuation">.</span><span class="cm-identifier">aliyuncs</span><span class="cm-punctuation">.</span><span class="cm-identifier">com</span><span class="cm-operator">/</span><span class="cm-identifier">docker-engine</span><span class="cm-operator">/</span><span class="cm-identifier">internet</span> <span class="cm-operator">|</span> <span class="cm-identifier">sh</span> <span class="cm-operator">-</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 25px;"></div><div class="CodeMirror-gutters" style="display: none; height: 25px;"></div></div></div></pre><p>2.安装所需要的包</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="powershell"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="powershell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 3.60004px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">sudo</span> <span class="cm-identifier">apt-get</span> <span class="cm-identifier">install</span> <span class="cm-identifier">linux-image-extra</span><span class="cm-operator">-</span><span class="cm-error">$</span><span class="cm-punctuation">(</span><span class="cm-identifier">uname</span> <span class="cm-operator">-</span><span class="cm-builtin">r</span><span class="cm-punctuation">)</span> <span class="cm-identifier">linux-image-extra-virtual</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 25px;"></div><div class="CodeMirror-gutters" style="display: none; height: 25px;"></div></div></div></pre><p>3.添加使用 HTTPS 传输的软件包以及 CA 证书</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="powershell"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="powershell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 3.60004px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">sudo</span> <span class="cm-identifier">apt-get</span> <span class="cm-identifier">update</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">sudo</span> <span class="cm-identifier">apt-get</span> <span class="cm-identifier">install</span> <span class="cm-identifier">apt-transport-https</span> <span class="cm-identifier">ca-certificates</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 50px;"></div><div class="CodeMirror-gutters" style="display: none; height: 50px;"></div></div></div></pre><p>4.添加GPG密钥</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="powershell"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="powershell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 3.60004px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">sudo</span> <span class="cm-identifier">apt-key</span> <span class="cm-identifier">adv</span> <span class="cm-operator">--</span><span class="cm-identifier">keyserver</span> <span class="cm-identifier">hkp</span><span class="cm-operator">://</span><span class="cm-identifier">p80</span><span class="cm-punctuation">.</span><span class="cm-identifier">pool</span><span class="cm-punctuation">.</span><span class="cm-identifier">sks-keyservers</span><span class="cm-punctuation">.</span><span class="cm-identifier">net</span><span class="cm-operator">:</span><span class="cm-number">80</span> <span class="cm-operator">--</span><span class="cm-identifier">recv-keys</span> <span class="cm-number">58118E89</span><span class="cm-identifier">F3A912897C070ADBF76221572C52609D</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 50px;"></div><div class="CodeMirror-gutters" style="display: none; height: 50px;"></div></div></div></pre><p>5.添加软件源</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="powershell"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="powershell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 3.60004px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">echo</span> <span class="cm-string">"deb https://apt.dockerproject.org/repo ubuntu-xenial main"</span> <span class="cm-operator">|</span> <span class="cm-identifier">sudo</span> <span class="cm-builtin">tee</span> <span class="cm-operator">/</span><span class="cm-identifier">etc</span><span class="cm-operator">/</span><span class="cm-identifier">apt</span><span class="cm-operator">/</span><span class="cm-identifier">sources</span><span class="cm-punctuation">.</span><span class="cm-identifier">list</span><span class="cm-punctuation">.</span><span class="cm-identifier">d</span><span class="cm-operator">/</span><span class="cm-identifier">docker</span><span class="cm-punctuation">.</span><span class="cm-identifier">list</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 50px;"></div><div class="CodeMirror-gutters" style="display: none; height: 50px;"></div></div></div></pre><p>6.添加成功后更新软件包缓存</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="powershell"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="powershell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 3.60004px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">sudo</span> <span class="cm-identifier">apt-get</span> <span class="cm-identifier">update</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 25px;"></div><div class="CodeMirror-gutters" style="display: none; height: 25px;"></div></div></div></pre><p>7.安装docker</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="powershell"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="powershell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 3.60004px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">sudo</span> <span class="cm-identifier">apt-get</span> <span class="cm-identifier">install</span> <span class="cm-identifier">docker-engine</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 25px;"></div><div class="CodeMirror-gutters" style="display: none; height: 25px;"></div></div></div></pre><p>8.启动 docker</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="powershell"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="powershell"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 3.60004px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">sudo</span> <span class="cm-identifier">systemctl</span> <span class="cm-identifier">enable</span> <span class="cm-identifier">docker</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">sudo</span> <span class="cm-identifier">systemctl</span> <span class="cm-builtin">start</span> <span class="cm-identifier">docker</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 50px;"></div><div class="CodeMirror-gutters" style="display: none; height: 50px;"></div></div></div></pre><p>&nbsp;</p><h2><a name='header-n23' class='md-header-anchor '></a>Docker 配置文件</h2><h3><a name='header-n24' class='md-header-anchor '></a>/etc/docker/daemon.json</h3><p>日志驱动类型。</p><ul><li>none：容器不输出任何日志；</li><li>json-file：容器输出的日志以 JSON 格式写入文件中（默认）；</li><li>syslog：容器输出的日志写入宿主机的 Syslog 中；</li><li>journald：容器输出的日志写入宿主机的 Journald 中；</li><li>gelf：容器输出到日志以 GELF（Graylog Extended Log Format）格式写入 Graylog中；</li><li>fluentd：容器输出的日志写入宿主机的 Fluented 中；</li><li>awslogs：容器输出的日志写入 Amazon CloudWatch Logs 中；</li><li>splunk：容器输出的日志写入 splunk 中；</li><li>etwlogs：容器输出的日志写入 ETW （Event Tracing for Windows）；</li><li>mats：容器输出的日志写入 NATS 服务中；</li></ul><p>我们可以在 docker run 命令中通过  --log-driver 参数来设置具体的 Docker 日志驱动，也可以通过 --log-opt 参数来指定对应日志驱动的相关选项。就拿 json-file 来说，其实可以这样启动 Docker 容器：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n48" mdtype="fences">docker run \
-d \
-p 80:80 \
--log-driver json-file \
--log-opt max-size=10m \
--log-opt max-file=3 \
--name nginx \
nginx
</pre><p>通过 --log-opt 参数为 json-file 日志驱动添加了两个选项，max-size=10m 表示  JSON 文件最大为 10MB（超过 10MB 就会自动生成新文件），max-file=3 表示 JSON 文件最多为3个（超过3个就会自动删除多余的旧文件）
 除了在启动 Docker 容器时，可指定日志驱动以外，还可以通过修改 Docker 配置文件来指定日志驱动。</p><p>然后重启 docker</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n51" mdtype="fences">systemctl restart docker
</pre><p>&nbsp;</p><h2><a name='header-n53' class='md-header-anchor '></a>运行容器</h2><h3><a name='header-n54' class='md-header-anchor '></a>要使用root权限<span>	</span>docker run*</h3><p>Docker 允许你在容器内运行应用程序， 使用 <strong>docker run</strong> 命令来在容器内运行一个应用程序。</p><p>输出Hello world</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n57" mdtype="fences">runoob@runoob:~$ docker run ubuntu:15.10 /bin/echo "Hello world"
Hello world
</pre><ul><li><strong>docker:</strong> Docker 的二进制执行文件。</li><li><strong>run:</strong>与前面的 docker 组合来运行一个容器。</li><li><strong>ubuntu:15.10</strong>指定要运行的镜像，Docker首先从本地主机上查找镜像是否存在，如果不存在，Docker 就会从镜像仓库 Docker Hub 下载公共镜像。</li><li><strong>/bin/echo &quot;Hello world&quot;:</strong> 在启动的容器里执行的命令</li></ul><p>以上命令完整的意思可以解释为：Docker 以 ubuntu15.10 镜像创建一个新容器，然后在容器里执行 bin/echo &quot;Hello world&quot;，然后输出结果。</p><p>&nbsp;</p><h3><a name='header-n69' class='md-header-anchor '></a>运行交互式的容器<span>	</span>docker run -i -t</h3><p>我们通过docker的两个参数 -i -t，让docker运行的容器实现&quot;对话&quot;的能力</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="powershell" contenteditable="false" cid="n71" mdtype="fences">runoob@runoob:~$ docker run -i -t ubuntu:15.10 /bin/bash
root@dc0050c79503:/#
</pre><p>各个参数解析：</p><ul><li><strong>-t:</strong>在新容器内指定一个伪终端或终端。</li><li><strong>-i:</strong>允许你对容器内的标准输入 (STDIN) 进行交互。</li></ul><p>此时我们已进入一个 ubuntu15.10系统的容器</p><p>我们可以通过运行exit命令或者使用CTRL+D来退出容器。</p><p>&nbsp;</p><h3><a name='header-n81' class='md-header-anchor '></a>-v挂载主机上的文件到容器</h3><p>Docker容器启动的时候，如果要挂载宿主机的一个目录，可以用-v参数指定。</p><p>譬如我要启动一个centos容器，宿主机的/test目录挂载到容器的/soft目录，可通过以下方式指定：</p><p># docker run -it -v /test:/soft centos /bin/bash</p><p>这样在容器启动后，容器内会自动创建/soft的目录。通过这种方式，我们可以明确一点，即-v参数中，冒号&quot;:&quot;前面的目录是宿主机目录，后面的目录是容器内目录。</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n86" mdtype="fences">-v $PWD/conf/nginx.conf:/etc/nginx/nginx.conf 
-v $PWD/log:/var/log/nginx 
-v $PWD/html:/usr/share/nginx/html
</pre><p><strong>容器目录不可以为相对路径</strong></p><p><strong>宿主机目录如果不存在，则会自动生成</strong></p><p>&nbsp;</p><h3><a name='header-n90' class='md-header-anchor '></a>启动容器（后台模式）docker run -d </h3><p>使用以下命令创建一个以进程方式运行的容器</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="powershell" contenteditable="false" cid="n92" mdtype="fences">runoob@runoob:~$ docker run -d ubuntu:15.10 /bin/sh -c "while true; do echo hello world; sleep 1; done"
2b1b7a428627c51ab8810d541d759f072b4fc75487eed05812646b8534a2fe63
</pre><p>在输出中，我们没有看到期望的&quot;hello world&quot;，而是一串长字符</p><p><strong>2b1b7a428627c51ab8810d541d759f072b4fc75487eed05812646b8534a2fe63</strong></p><p>这个长字符串叫做容器ID，对每个容器来说都是唯一的，我们可以通过容器ID来查看对应的容器发生了什么。</p><p>&nbsp;</p><h2><a name='header-n97' class='md-header-anchor '></a>查看容器列表<span>	</span>docker ps</h2><p>首先，我们需要确认容器有在运行，可以通过 <strong>docker ps</strong> 来查看</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="powershell" contenteditable="false" cid="n99" mdtype="fences">root@VM-0-17-ubuntu:~# docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
5dcca695b320        ubuntu:15.10        "/bin/sh -c 'while..."   4 seconds ago       Up 3 seconds                            objective_hawking

</pre><p><strong>CONTAINER ID:</strong>容器ID</p><p><strong>NAMES:</strong>自动分配的容器名称</p><p>&nbsp;</p><h2><a name='header-n103' class='md-header-anchor '></a>查看容器运行记录</h2><p><strong>docker logs</strong></p><h4><a name='header-n105' class='md-header-anchor '></a>在容器内使用docker logs命令，查看容器内的标准输出,参数为  id   或  容器名字</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="powershell" contenteditable="false" cid="n106" mdtype="fences">runoob@runoob:~$ docker logs 5dcca695b320
runoob@runoob:~$ docker logs objective_hawking
</pre><p>&nbsp;</p><h2><a name='header-n108' class='md-header-anchor '></a>进入容器</h2><p>先运行容器</p><p>然后使用如下命令进入交互式终端：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n111" mdtype="fences">`docker exec -it mynginx /bin/bash`
</pre><p>&nbsp;</p><h2><a name='header-n113' class='md-header-anchor '></a>停止容器<span>	</span>docker stop</h2><p>我们使用 <strong>docker stop</strong> 命令来停止容器:</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="powershell" contenteditable="false" cid="n115" mdtype="fences">root@VM-0-17-ubuntu:~# docker stop 5dcca695b320
root@VM-0-17-ubuntu:~# docker stop objective_hawking
5dcca695b320
</pre><p>&nbsp;</p><h2><a name='header-n117' class='md-header-anchor '></a>Docker 客户端</h2><p>docker 客户端非常简单 ,我们可以直接输入 docker 命令来查看到 Docker 客户端的所有命令选项。</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n119" mdtype="fences">runoob@runoob:~# docker
</pre><p>可以通过命令 <strong>docker command --help</strong> 更深入的了解指定的 Docker 命令使用方法。</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n121" mdtype="fences">runoob@runoob:~# docker stats --help
</pre><p>&nbsp;</p><h3><a name='header-n123' class='md-header-anchor '></a><strong>-P :</strong>将容器内部使用的网络端口映射到我们使用的主机上。</h3><ul><li><strong>-P :</strong>是容器内部端口随机映射到主机的高端口。</li><li><strong>-p :</strong> 是容器内部端口绑定到指定的主机端口</li></ul><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n129" mdtype="fences">runoob@runoob:~# docker run -d -P training/webapp python app.py
</pre><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n130" mdtype="fences">runoob@runoob:~#  docker ps
CONTAINER ID        IMAGE               COMMAND             ...        PORTS                 
d3d5e39ed9d3        training/webapp     "python app.py"     ...        0.0.0.0:32769-&gt;5000/tcp
</pre><p>这里多了端口信息。</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n132" mdtype="fences">PORTS
0.0.0.0:32769-&gt;5000/tcp
</pre><p>Docker 开放了 5000 端口（默认 Python Flask 端口）映射到主机端口 32769 上。</p><p>我们通过   ip:32769  访问此应用</p><p>我们也可以通过 -p 参数来设置不一样的端口：</p><p><span>	</span>容器内部的 5000 端口映射到我们本地主机的 5000 端口上。</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n137" mdtype="fences">runoob@runoob:~$ docker run -d -p 5000:5000 training/webapp python app.py
</pre><h3><a name='header-n138' class='md-header-anchor '></a>使用 <strong>docker port</strong> 可以查看指定 （ID 或者名字）容器的某个确定端口映射到宿主机的端口号。</h3><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="powershell" contenteditable="false" cid="n139" mdtype="fences">runoob@runoob:~$ docker port bf08b7f2cd89
runoob@runoob:~$ docker port wizardly_chandrasekhar
5000/tcp -&gt; 0.0.0.0:5000
</pre><p>我们可以指定容器绑定的网络地址，比如绑定 127.0.0.1。</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n141" mdtype="fences">runoob@runoob:~$ docker run -d -p 127.0.0.1:5001:5000 training/webapp python app.py
95c6ceef88ca3e71eaf303c2833fd6701d8d1b2572b5613b5a932dfdfe8a857c
</pre><p>这样我们就可以通过访问 127.0.0.1:5001 来访问容器的 5000 端口。</p><p>上面的例子中，默认都是绑定 tcp 端口，如果要绑定 UDP 端口，可以在端口后面加上 <strong>/udp</strong>。</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n144" mdtype="fences">runoob@runoob:~$ docker run -d -p 127.0.0.1:5000:5000/udp training/webapp python app.py
</pre><p>&nbsp;</p><h2><a name='header-n146' class='md-header-anchor '></a>查看 WEB 应用程序日志</h2><p>docker logs [ID或者名字] 可以查看容器内部的标准输出。</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n148" mdtype="fences">runoob@runoob:~$ docker logs -f bf08b7f2cd89
 * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)
192.168.239.1 - - [09/May/2016 16:30:37] "GET / HTTP/1.1" 200 -
192.168.239.1 - - [09/May/2016 16:30:37] "GET /favicon.ico HTTP/1.1" 404 -
</pre><p><strong>-f:</strong> 让 <strong>docker logs</strong> 像使用 <strong>tail -f</strong> 一样来输出容器内部的标准输出。</p><h2><a name='header-n150' class='md-header-anchor '></a>检查 WEB 应用程序</h2><p>使用 <strong>docker inspect</strong> 来查看 Docker 的底层信息。它会返回一个 JSON 文件记录着 Docker 容器的配置和状态信息。</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="json" contenteditable="false" cid="n152" mdtype="fences" style="break-inside: unset;">runoob@runoob:~$ docker inspect wizardly_chandrasekhar
[
    {
        "Id": "bf08b7f2cd897b5964943134aa6d373e355c286db9b9885b1f60b6e8f82b2b85",
        "Created": "2018-09-17T01:41:26.174228707Z",
        "Path": "python",
        "Args": [
            "app.py"
        ],
        "State": {
            "Status": "running",
            "Running": true,
            "Paused": false,
            "Restarting": false,
            "OOMKilled": false,
            "Dead": false,
            "Pid": 23245,
            "ExitCode": 0,
            "Error": "",
            "StartedAt": "2018-09-17T01:41:26.494185806Z",
            "FinishedAt": "0001-01-01T00:00:00Z"
        },
......
</pre><p>&nbsp;</p><h2><a name='header-n154' class='md-header-anchor '></a>停止 WEB 应用容器</h2><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n155" mdtype="fences">runoob@runoob:~$ docker stop wizardly_chandrasekhar   
wizardly_chandrasekhar
</pre><hr /><h2><a name='header-n157' class='md-header-anchor '></a>重启WEB应用容器</h2><p>已经停止的容器，我们可以使用命令 docker start 来启动。</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n159" mdtype="fences">runoob@runoob:~$ docker start wizardly_chandrasekhar
wizardly_chandrasekhar
</pre><p>docker ps -l 查询最后一次创建的容器：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n161" mdtype="fences">#  docker ps -l 
CONTAINER ID        IMAGE                             PORTS                     NAMES
bf08b7f2cd89        training/webapp     ...        0.0.0.0:5000-&gt;5000/tcp    wizardly_chandrasekhar
</pre><h2><a name='header-n162' class='md-header-anchor '></a>正在运行的容器，我们可以使用 docker restart 命令来重启</h2><p>&nbsp;</p><h2><a name='header-n164' class='md-header-anchor '></a>移除WEB应用容器</h2><h3><a name='header-n165' class='md-header-anchor '></a>我们可以使用 docker rm 命令来删除不需要的容器</h3><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n166" mdtype="fences">runoob@runoob:~$ docker rm wizardly_chandrasekhar  
wizardly_chandrasekhar
</pre><h4><a name='header-n167' class='md-header-anchor '></a>删除容器时，容器必须是停止状态，否则会报如下错误</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n168" mdtype="fences">runoob@runoob:~$ docker rm wizardly_chandrasekhar
Error response from daemon: You cannot remove a running container bf08b7f2cd897b5964943134aa6d373e355c286db9b9885b1f60b6e8f82b2b85. Stop the container before attempting removal or force remove
</pre><p>&nbsp;</p><h1><a name='header-n170' class='md-header-anchor '></a>Docker 镜像使用</h1><p>当运行容器时，使用的镜像如果在本地中不存在，docker 就会自动从 docker 镜像仓库中下载，默认是从 Docker Hub 公共镜像源下载。</p><h2><a name='header-n172' class='md-header-anchor '></a>列出镜像列表</h2><p><span>	</span>我们可以使用 <strong>docker images</strong> 来列出本地主机上的镜像。</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n174" mdtype="fences">runoob@runoob:~$ docker images           
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
ubuntu              14.04               90d5884b1ee0        5 days ago          188 MB
php                 5.6                 f40e9e0f10c8        9 days ago          444.8 MB
nginx               latest              6f8d099c3adc        12 days ago         182.7 MB
mysql               5.6                 f2e8d6c772c0        3 weeks ago         324.6 MB
httpd               latest              02ef73cf1bc0        3 weeks ago         194.4 MB
ubuntu              15.10               4e3b13c8a266        4 weeks ago         136.3 MB
hello-world         latest              690ed74de00f        6 months ago        960 B
training/webapp     latest              6fae60ef3446        11 months ago       348.8 MB
</pre><p>各个选项说明:</p><ul><li><strong>REPOSITORY：</strong>表示镜像的仓库源</li><li><strong>TAG：</strong>镜像的标签</li><li><strong>IMAGE ID：</strong>镜像ID</li><li><strong>CREATED：</strong>镜像创建时间</li><li><strong>SIZE：</strong>镜像大小</li></ul><p>同一仓库源可以有多个 TAG，代表这个仓库源的不同个版本，如ubuntu仓库源里，有15.10、14.04等多个不同的版本，我们使用 REPOSITORY:TAG 来定义不同的镜像。</p><p>所以，我们如果要使用版本为15.10的ubuntu系统镜像来运行容器时，命令如下：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n189" mdtype="fences">runoob@runoob:~$ docker run -t -i ubuntu:15.10 /bin/bash 
root@d77ccb2e5cca:/#
</pre><p>如果你不指定一个镜像的版本标签，例如你只使用 ubuntu，docker 将默认使用 ubuntu:latest 镜像。</p><h2><a name='header-n191' class='md-header-anchor '></a>获取一个新的镜像<span>	</span>docker pull </h2><p>当我们在本地主机上使用一个不存在的镜像时 Docker 就会自动下载这个镜像。如果我们想预先下载这个镜像，我们可以使用 docker pull 命令来下载它。</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n193" mdtype="fences">runoob@runoob:~# docker pull training/webapp
</pre><h2><a name='header-n194' class='md-header-anchor '></a>查找镜像</h2><p>我们可以从 Docker Hub 网站来搜索镜像，Docker Hub 网址为： <a href='https://hub.docker.com/' target='_blank' class='url'>https://hub.docker.com/</a></p><p>我们也可以使用 docker search 命令来搜索镜像。比如我们需要一个httpd的镜像来作为我们的web服务。我们可以通过 docker search 命令搜索 httpd 来寻找适合我们的镜像。</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n197" mdtype="fences">root@VM-0-17-ubuntu:~# docker search httpd
NAME                          DESCRIPTION                  		STARS     OFFICIAL   AUTOMATED
httpd                         The Apache HTTP Server Project    2447      [OK]       
hypriot/rpi-busybox-httpd     Raspberry Pi compatible Docker  	46                     [OK]
</pre><p><strong>NAME:</strong>镜像仓库源的名称</p><p><strong>DESCRIPTION:</strong>镜像的描述</p><p><strong>OFFICIAL:</strong>是否docker官方发布</p><p>&nbsp;</p><h2><a name='header-n202' class='md-header-anchor '></a>创建镜像</h2><p>当我们从docker镜像仓库中下载的镜像不能满足我们的需求时，我们可以通过以下两种方式对镜像进行更改。</p><ul><li>1.从已经创建的容器中更新镜像，并且提交这个镜像</li><li>2.使用 Dockerfile 指令来创建一个新的镜像</li></ul><h3><a name='header-n209' class='md-header-anchor '></a>更新镜像</h3><p>更新镜像之前，我们需要使用镜像来创建一个容器。</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n211" mdtype="fences">runoob@runoob:~$ docker run -t -i ubuntu:15.10 /bin/bash
root@e218edb10161:/# 
</pre><p>在运行的容器内使用 apt-get update 命令进行更新。</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n213" mdtype="fences">root@d161f9a55b05:/# apt-get update
</pre><p>在完成操作之后，输入 exit命令来退出这个容器。</p><p>此时ID为e218edb10161的容器，是按我们的需求更改的容器。我们可以通过命令 docker commit来提交容器副本。</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n216" mdtype="fences">runoob@runoob:~$ docker commit -m="has update" -a="runoob" e218edb10161 runoob/ubuntu:v2
sha256:70bf1840fd7c0d2d8ef0a42a817eb29f854c1af8f7c59fc03ac7bdee9545aff8
</pre><p>各个参数说明：</p><ul><li><strong>-m:</strong>提交的描述信息</li><li><strong>-a:</strong>指定镜像作者</li><li><strong>e218edb10161：</strong>容器ID</li><li><strong>runoob/ubuntu:v2:</strong>指定要创建的目标镜像名</li></ul><p>我们可以使用 <strong>docker images</strong> 命令来查看我们的新镜像 <strong>runoob/ubuntu:v2</strong>：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n228" mdtype="fences">runoob@runoob:~$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
runoob/ubuntu       v2                  70bf1840fd7c        15 seconds ago      158.5 MB
ubuntu              14.04               90d5884b1ee0        5 days ago          188 MB
php                 5.6                 f40e9e0f10c8        9 days ago          444.8 MB
nginx               latest              6f8d099c3adc        12 days ago         182.7 MB
mysql               5.6                 f2e8d6c772c0        3 weeks ago         324.6 MB
httpd               latest              02ef73cf1bc0        3 weeks ago         194.4 MB
ubuntu              15.10               4e3b13c8a266        4 weeks ago         136.3 MB
hello-world         latest              690ed74de00f        6 months ago        960 B
training/webapp     latest              6fae60ef3446        12 months ago       348.8 MB
</pre><p>使用我们的新镜像 <strong>runoob/ubuntu</strong> 来启动一个容器</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n230" mdtype="fences">runoob@runoob:~$ docker run -t -i runoob/ubuntu:v2 /bin/bash                            
root@1a9fbdeb5da3:/#
</pre><h3><a name='header-n231' class='md-header-anchor '></a>构建镜像</h3><p>我们使用命令 <strong>docker build</strong> ， 从零开始来创建一个新的镜像。为此，我们需要创建一个 Dockerfile 文件，其中包含一组指令来告诉 Docker 如何构建我们的镜像。</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n233" mdtype="fences">runoob@runoob:~$ cat Dockerfile 
FROM    centos:6.7
MAINTAINER      Fisher "fisher@sudops.com"

RUN     /bin/echo 'root:123456' |chpasswd
RUN     useradd runoob
RUN     /bin/echo 'runoob:123456' |chpasswd
RUN     /bin/echo -e "LANG=\"en_US.UTF-8\"" &gt;/etc/default/local
EXPOSE  22
EXPOSE  80
CMD     /usr/sbin/sshd -D
</pre><p>每一个指令都会在镜像上创建一个新的层，每一个指令的前缀都必须是大写的。</p><h2><a name='header-n235' class='md-header-anchor '></a>Dockerfile的基本结构</h2><p>Dockerfile 一般分为四部分：基础镜像信息、维护者信息、镜像操作指令和容器启动时执行指令，’#’ 为 Dockerfile 中的注释。</p><p><strong>FROM：指定基础镜像，必须为第一个命令</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n238" mdtype="fences">格式：
　　FROM &lt;image&gt;
　　FROM &lt;image&gt;:&lt;tag&gt;
　　FROM &lt;image&gt;@&lt;digest&gt;
示例：
　　FROM mysql:5.6
注：
　　tag或digest是可选的，如果不使用这两个值时，会使用latest版本的基础镜像
</pre><p><strong>MAINTAINER: 维护者信息</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n240" mdtype="fences">格式：
    MAINTAINER &lt;name&gt;
示例：
    MAINTAINER Jasper Xu
    MAINTAINER sorex@163.com
    MAINTAINER Jasper Xu &lt;sorex@163.com&gt;
</pre><h4><a name='header-n241' class='md-header-anchor '></a>RUN 指令告诉docker 在镜像内执行命令，安装了什么。。。</h4><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n242" mdtype="fences">RUN用于在镜像容器中执行命令，其有以下两种命令执行方式：
shell执行
格式：
    RUN &lt;command&gt;
exec执行
格式：
    RUN ["executable", "param1", "param2"]
示例：
    RUN ["executable", "param1", "param2"]
    RUN apk update
    RUN ["/etc/execfile", "arg1", "arg1"]
注：
　　RUN指令创建的中间镜像会被缓存，并会在下次构建中使用。如果不想使用这些缓存镜像，可以在构建时指定--no-cache参数，如：docker build --no-cache
</pre><p><strong>ADD：将本地文件添加到容器中，tar类型文件会自动解压(网络压缩资源不会被解压)，可以访问网络资源，类似wget</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n244" mdtype="fences">格式：
    ADD &lt;src&gt;... &lt;dest&gt;
    ADD ["&lt;src&gt;",... "&lt;dest&gt;"] 用于支持包含空格的路径
示例：
    ADD hom* /mydir/          # 添加所有以"hom"开头的文件
    ADD hom?.txt /mydir/      # ? 替代一个单字符,例如："home.txt"
    ADD test relativeDir/     # 添加 "test" 到 `WORKDIR`/relativeDir/
    ADD test /absoluteDir/    # 添加 "test" 到 /absoluteDir/
</pre><p><strong>COPY：功能类似ADD，但是是不会自动解压文件，也不能访问网络资源</strong></p><p><strong>CMD：构建容器后调用，也就是在容器启动时才进行调用。</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n247" mdtype="fences">格式：
    CMD ["executable","param1","param2"] (执行可执行文件，优先)
    CMD ["param1","param2"] (设置了ENTRYPOINT，则直接调用ENTRYPOINT添加参数)
    CMD command param1 param2 (执行shell内部命令)
示例：
    CMD echo "This is a test." | wc -
    CMD ["/usr/bin/wc","--help"]
注：
 　　CMD不同于RUN，CMD用于指定在容器启动时所要执行的命令，而RUN用于指定镜像构建时所要执行的命令。
</pre><p><strong>ENTRYPOINT：配置容器，使其可执行化。配合CMD可省去&quot;application&quot;，只使用参数。</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n249" mdtype="fences">格式：
    ENTRYPOINT ["executable", "param1", "param2"] (可执行文件, 优先)
    ENTRYPOINT command param1 param2 (shell内部命令)
示例：
    FROM ubuntu
    ENTRYPOINT ["top", "-b"]
    CMD ["-c"]
注：
　　　ENTRYPOINT与CMD非常类似，不同的是通过docker run执行的命令不会覆盖ENTRYPOINT，而docker run命令中指定的任何参数，都会被当做参数再次传递给ENTRYPOINT。Dockerfile中只允许有一个ENTRYPOINT命令，多指定时会覆盖前面的设置，而只执行最后的ENTRYPOINT指令。
</pre><p><strong>LABEL：用于为镜像添加元数据</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n251" mdtype="fences">格式：
    LABEL &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; ...
示例：
　　LABEL version="1.0" description="这是一个Web服务器" by="IT笔录"
注：
　　使用LABEL指定元数据时，一条LABEL指定可以指定一或多条元数据，指定多条元数据时不同元数据之间通过空格分隔。推荐将所有的元数据通过一条LABEL指令指定，以免生成过多的中间镜像。
</pre><p><strong>ENV：设置环境变量</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n253" mdtype="fences">格式：
    ENV &lt;key&gt; &lt;value&gt;  #&lt;key&gt;之后的所有内容均会被视为其&lt;value&gt;的组成部分，因此，一次只能设置一个变量
    ENV &lt;key&gt;=&lt;value&gt; ...  #可以设置多个变量，每个变量为一个"&lt;key&gt;=&lt;value&gt;"的键值对，如果&lt;key&gt;中包含空格，可以使用\来进行转义，也可以通过""来进行标示；另外，反斜线也可以用于续行
示例：
    ENV myName John Doe
    ENV myDog Rex The Dog
    ENV myCat=fluffy
</pre><p><strong>EXPOSE：指定于外界交互的端口</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n255" mdtype="fences">格式：
    EXPOSE &lt;port&gt; [&lt;port&gt;...]
示例：
    EXPOSE 80 443
    EXPOSE 8080
    EXPOSE 11211/tcp 11211/udp
注：
　　EXPOSE并不会让容器的端口访问到主机。要使其可访问，需要在docker run运行容器时通过-p来发布这些端口，或通过-P参数来发布EXPOSE导出的所有端口
</pre><p><strong>VOLUME：用于指定持久化目录</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n257" mdtype="fences">格式：
    VOLUME ["/path/to/dir"]
示例：
    VOLUME ["/data"]
    VOLUME ["/var/www", "/var/log/apache2", "/etc/apache2"
注：
　　一个卷可以存在于一个或多个容器的指定目录，该目录可以绕过联合文件系统，并具有以下功能：
1 卷可以容器间共享和重用
2 容器并不一定要和其它容器共享卷
3 修改卷后会立即生效
4 对卷的修改不会对镜像产生影响
5 卷会一直存在，直到没有任何容器在使用它
</pre><p><strong>WORKDIR：工作目录，类似于cd命令</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n259" mdtype="fences">格式：
    WORKDIR /path/to/workdir
示例：
    WORKDIR /a  (这时工作目录为/a)
    WORKDIR b  (这时工作目录为/a/b)
    WORKDIR c  (这时工作目录为/a/b/c)
注：
　　通过WORKDIR设置工作目录后，Dockerfile中其后的命令RUN、CMD、ENTRYPOINT、ADD、COPY等命令都会在该目录下执行。在使用docker run运行容器时，可以通过-w参数覆盖构建时所设置的工作目录。
</pre><p><strong>USER:*</strong>*指定运行容器时的用户名或 UID，后续的 RUN 也会使用指定用户。使用USER指定用户时，可以使用用户名、UID或GID，或是两者的组合。当服务不需要管理员权限时，可以通过该命令指定运行用户。并且可以在之前创建所需要的用户**</p><p> 格式:
　　USER user
　　USER user:group
　　USER uid
　　USER uid:gid
　　USER user:gid
　　USER uid:group</p><p> 示例：
　　USER www</p><p> 注：</p><p>　　使用USER指定用户后，Dockerfile中其后的命令RUN、CMD、ENTRYPOINT都将使用该用户。镜像构建完成后，通过<code>docker run</code>运行容器时，可以通过-u参数来覆盖所指定的用户。</p><p><strong>ARG：用于指定传递给构建运行时的变量</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n266" mdtype="fences">格式：
    ARG &lt;name&gt;[=&lt;default value&gt;]
示例：
    ARG site
    ARG build_user=www
</pre><p><strong>ONBUILD：用于设置镜像触发器</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n268" mdtype="fences">格式：
　　ONBUILD [INSTRUCTION]
示例：
　　ONBUILD ADD . /app/src
　　ONBUILD RUN /usr/local/bin/python-build --dir /app/src
注：
　　当所构建的镜像被用做其它镜像的基础镜像，该镜像中的触发器将会被钥触发
</pre><p><strong>以下是一个小例子：</strong></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n270" mdtype="fences" style="break-inside: unset;"># This my first nginx Dockerfile
# Version 1.0

# Base images 基础镜像
FROM centos

#MAINTAINER 维护者信息
MAINTAINER tianfeiyu 

#ENV 设置环境变量
ENV PATH /usr/local/nginx/sbin:$PATH

#ADD  文件放在当前目录下，拷过去会自动解压
ADD nginx-1.8.0.tar.gz /usr/local/  
ADD epel-release-latest-7.noarch.rpm /usr/local/  

#RUN 执行以下命令 
RUN rpm -ivh /usr/local/epel-release-latest-7.noarch.rpm
RUN yum install -y wget lftp gcc gcc-c++ make openssl-devel pcre-devel pcre &amp;&amp; yum clean all
RUN useradd -s /sbin/nologin -M www

#WORKDIR 相当于cd
WORKDIR /usr/local/nginx-1.8.0 

RUN ./configure --prefix=/usr/local/nginx --user=www --group=www --with-http_ssl_module --with-pcre &amp;&amp; make &amp;&amp; make install

RUN echo "daemon off;" &gt;&gt; /etc/nginx.conf

#EXPOSE 映射端口
EXPOSE 80

#CMD 运行以下命令
CMD ["nginx"]
</pre><h3><a name='header-n271' class='md-header-anchor '></a>然后，我们使用 Dockerfile 文件，通过 docker build 命令来构建一个镜像。</h3><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n272" mdtype="fences">runoob@runoob:~$ docker build -t runoob/centos:6.7 .
Sending build context to Docker daemon 17.92 kB
Step 1 : FROM centos:6.7
 ---&amp;gt; d95b5ca17cc3
Step 2 : MAINTAINER Fisher "fisher@sudops.com"
 ---&amp;gt; Using cache
 ---&amp;gt; 0c92299c6f03
Step 3 : RUN /bin/echo 'root:123456' |chpasswd
 ---&amp;gt; Using cache
 ---&amp;gt; 0397ce2fbd0a
Step 4 : RUN useradd runoob
......
</pre><p>参数说明：</p><ul><li><strong>-t</strong> ：指定要创建的目标镜像名</li><li><strong>.</strong> ：Dockerfile 文件所在目录，可以指定Dockerfile 的绝对路径</li></ul><p>我们可以使用新的镜像来创建容器</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n280" mdtype="fences">runoob@runoob:~$ docker run -t -i runoob/centos:6.7  /bin/bash
[root@41c28d18b5fb /]# id runoob
uid=500(runoob) gid=500(runoob) groups=500(runoob)
</pre><h2><a name='header-n281' class='md-header-anchor '></a>设置镜像标签</h2><p>我们可以使用 docker tag 命令，为镜像添加一个新的标签。</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n283" mdtype="fences">runoob@runoob:~$ docker tag 860c279d2fec runoob/centos:dev
</pre><p>docker tag 镜像ID，这里是 860c279d2fec ,用户名称、镜像源名(repository name)和新的标签名(tag)。</p><h2><a name='header-n285' class='md-header-anchor '></a>删除指定的镜像</h2><p>通过sudo docker rmi xxx 来删除指定的镜像，镜像存在依赖关系，先删除最下层，最后删除顶层，建议根据镜像名字来删除</p><h2><a name='header-n287' class='md-header-anchor '></a>修改镜像</h2><p>pull到的镜像肯定有很多需要修改的地方，比如配置文件等或者要自己增加些什么玩意儿进去</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n289" mdtype="fences">runoob@runoob:~$ docker exec -it 54d26bbce3d6 /bin/bash
</pre><p>通过exec命令进入到容器内部进行操作， 其中红色部分可以是容器id或容器名字</p><p>进入之后就和操作新的系统一样，操作完成之后输入exit退出</p><h2><a name='header-n292' class='md-header-anchor '></a>保存修改的镜像到本地镜像库</h2><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n293" mdtype="fences">runoob@runoob:~$ docker commit nginx_xiao xiaochangwei/nginx:v1.0
</pre><p>&nbsp;</p><h1><a name='header-n295' class='md-header-anchor '></a>Docker 容器连接</h1><p>端口映射并不是唯一把 docker 连接到另一个容器的方法。</p><p>docker 有一个连接系统允许将多个容器连接在一起，共享连接信息。</p><p>docker 连接会创建一个父子关系，其中父容器可以看到子容器的信息。</p><h3><a name='header-n299' class='md-header-anchor '></a>容器命名</h3><p>当我们创建一个容器的时候，docker 会自动对它进行命名。另外，我们也可以使用 <strong>--name</strong> 标识来命名容器，例如：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n301" mdtype="fences">runoob@runoob:~$  docker run -d -P --name runoob training/webapp python app.py
</pre><p>&nbsp;</p><h2><a name='header-n303' class='md-header-anchor '></a><strong>搭建自己的Dockers Registry</strong></h2><p>利用Docker容器安装一个Registry十分简单，只需要运行对应的容器即可。</p><p>docker run -d -p 5000:5000 registry</p><p>此时，我们已经启动了一个本地的registry。下面，我们需要使用本地的registry为我们想要推送的镜像打好标签。</p><p>docker tag 镜像id 127.0.0.1:5000/wangzhe0912/nginx</p><p>然后直接直接docker push命令来推送即可。</p><p>docker push 127.0.0.1:5000/wangzhe0912/nginx</p><p>Docker从1.3.X之后，与docker registry交互默认使用的是https，然而此处搭建的私有仓库只提供http服务，所以当与私有仓库交互式就会有上面的错误。</p><p>解决办法:</p><p>编辑/etc/docker/daemon.json   加入</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n313" mdtype="fences">"insecure-registries":["192.168.121.143:5000"] 
</pre><p>最后/etc/docker/daemon.json文件内容如下:</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n315" mdtype="fences">{"registry-mirrors":["http://hub-mirror.c.163.com"],"insecure-registries":["192.168.121.143:5000"] }
</pre><p>其中registry-mirrors是我加的docker镜像源。</p><p>编辑完成后，重启docker。</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 3.60004px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># systemctl restart docker</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 25px;"></div><div class="CodeMirror-gutters" style="display: none; height: 25px;"></div></div></div></pre><p><strong>但这种方法比较麻烦，需要修改每台宿主机上的/etc/docker/daemon.json</strong>  </p><p>&nbsp;</p><p>sudo docker run -d -p 5000:5000 --name registry-ser --restart=always --privileged=true  -v /docker/registry:/var/lib/registry  registry</p><p>启动镜像服务器
–restart=always 表示自动启动容器 
-v &lt;宿主机目录&gt;:&lt;容器目录&gt; 将宿主机的目录映射到容器上 
–privileged=true 给容器加权限，这样上传就不会因为目录权限出错 </p><h1><a name='header-n323' class='md-header-anchor '></a>docker镜像导入导出</h1><p>save指令导出镜像</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 3.60004px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sudo</span> <span class="cm-variable">docker</span> <span class="cm-variable">save</span> <span class="cm-variable">image</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">image</span>.<span class="cm-property">tar</span> </span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 25px;"></div><div class="CodeMirror-gutters" style="display: none; height: 25px;"></div></div></div></pre><p>load指令导入镜像</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm md-focus" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 3.60004px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo docker load &lt; image.tar </span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 25px;"></div><div class="CodeMirror-gutters" style="display: none; height: 25px;"></div></div></div></pre></div>
</body>
</html>